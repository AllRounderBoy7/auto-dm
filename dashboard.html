<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - InstaBot AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        /* Sidebar Styles - FIXED */
        .sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
        }
        
        @media (max-width: 1023px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                position: relative;
                transform: translateX(0) !important;
            }
        }
        
        /* Overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }
        .sidebar-overlay.active {
            display: block;
        }
        
        .glass-card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(20px); 
        }
        
        .loader { 
            border: 4px solid #f3f3f3; 
            border-top: 4px solid #667eea; 
            border-radius: 50%; 
            width: 40px; 
            height: 40px; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(5px); 
            z-index: 1000; 
            justify-content: center; 
            align-items: center; 
        }
        .modal.active { 
            display: flex; 
        }
        
        /* Nav link active state */
        .nav-link.active {
            background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%);
            color: #7c3aed;
            font-weight: 600;
        }
        
        /* Toast animation */
        .toast {
            transition: all 0.3s ease;
        }
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        .toast.hide {
            transform: translateY(100%);
            opacity: 0;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c4b5fd; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #7c3aed; }
        
        /* Section transition */
        section {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>
    
    <div class="flex h-screen overflow-hidden">
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- SIDEBAR - FIXED -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <aside id="sidebar" class="sidebar w-64 h-full bg-white shadow-xl flex flex-col">
            <div class="p-6 flex-shrink-0">
                <div class="flex items-center space-x-2 mb-8">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl flex items-center justify-center">
                        <i class="fab fa-instagram text-white text-xl"></i>
                    </div>
                    <span class="text-xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">InstaBot AI</span>
                </div>
                
                <nav class="space-y-2" id="navMenu">
                    <a href="#" data-section="dashboard" class="nav-link active flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                        <i class="fas fa-home w-5"></i><span>Dashboard</span>
                    </a>
                    <a href="#" data-section="automation" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fas fa-robot w-5"></i><span>Automation</span>
                    </a>
                    <a href="#" data-section="messages" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fas fa-envelope w-5"></i><span>Messages</span>
                    </a>
                    <a href="#" data-section="analytics" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fas fa-chart-bar w-5"></i><span>Analytics</span>
                    </a>
                    <a href="#" data-section="accounts" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fab fa-instagram w-5"></i><span>Accounts</span>
                    </a>
                    <a href="#" data-section="billing" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fas fa-credit-card w-5"></i><span>Billing</span>
                    </a>
                    <a href="#" data-section="settings" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-100 transition-all duration-200">
                        <i class="fas fa-cog w-5"></i><span>Settings</span>
                    </a>
                    
                    <!-- Admin Link (Hidden by default) -->
                    <a href="#" data-section="admin" id="adminNavLink" class="nav-link hidden flex items-center space-x-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 transition-all duration-200">
                        <i class="fas fa-shield-alt w-5"></i><span>Admin Panel</span>
                    </a>
                </nav>
            </div>
            
            <!-- Plan Status - FIXED positioning -->
            <div class="mt-auto p-6">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-4 text-white">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium" id="currentPlan">Free Plan</span>
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="text-sm opacity-80 mb-3">
                        <span id="dmsUsed">0</span>/<span id="dmsLimit">100</span> DMs used
                    </div>
                    <div class="w-full bg-white/30 rounded-full h-2 mb-3">
                        <div id="usageBar" class="bg-white rounded-full h-2 transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <button onclick="showSection('billing')" class="w-full py-2 bg-white text-purple-600 rounded-lg font-medium text-sm hover:bg-gray-100 transition">
                        Upgrade Plan
                    </button>
                </div>
            </div>
        </aside>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- MAIN CONTENT -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <main class="flex-1 overflow-y-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm sticky top-0 z-30">
                <div class="flex items-center justify-between px-4 lg:px-6 py-4">
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleSidebar()" class="lg:hidden text-gray-600 p-2 hover:bg-gray-100 rounded-lg">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-full">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                        
                        <div class="relative">
                            <button onclick="toggleUserDropdown()" class="flex items-center space-x-3 p-2 hover:bg-gray-100 rounded-xl transition">
                                <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=7c3aed&color=fff" class="w-10 h-10 rounded-full">
                                <span id="userName" class="hidden md:block font-medium text-gray-700">User</span>
                                <i class="fas fa-chevron-down text-gray-400 hidden md:block"></i>
                            </button>
                            
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg py-2 z-50 border">
                                <div class="px-4 py-2 border-b">
                                    <p id="dropdownEmail" class="text-sm text-gray-500 truncate">user@email.com</p>
                                    <p id="dropdownRole" class="text-xs text-purple-600 font-medium">Free Plan</p>
                                </div>
                                <a href="#" onclick="showSection('settings'); closeDropdown();" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user mr-2"></i> Profile
                                </a>
                                <a href="#" onclick="showSection('billing'); closeDropdown();" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-credit-card mr-2"></i> Billing
                                </a>
                                <hr class="my-2">
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-red-600 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- DASHBOARD SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="dashboardSection" class="p-4 lg:p-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
                    <div class="glass-card rounded-2xl p-6 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Total DMs Sent</p>
                                <h3 id="totalDms" class="text-3xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-paper-plane text-purple-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-green-500 text-sm mt-2"><i class="fas fa-arrow-up"></i> +12% from last week</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Auto Replies</p>
                                <h3 id="totalReplies" class="text-3xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-reply text-blue-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-green-500 text-sm mt-2"><i class="fas fa-arrow-up"></i> +8% from last week</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Response Rate</p>
                                <h3 id="responseRate" class="text-3xl font-bold text-gray-800">0%</h3>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-percentage text-green-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-green-500 text-sm mt-2"><i class="fas fa-arrow-up"></i> +5% from last week</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm hover:shadow-md transition">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Active Campaigns</p>
                                <h3 id="activeCampaigns" class="text-3xl font-bold text-gray-800">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-bullhorn text-orange-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm mt-2">Running now</p>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid lg:grid-cols-2 gap-6 mb-8">
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">DM Activity (Last 7 Days)</h3>
                        <div class="h-64">
                            <canvas id="dmChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Response Analytics</h3>
                        <div class="h-64">
                            <canvas id="responseChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="glass-card rounded-2xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
                    <div id="recentActivity" class="space-y-4">
                        <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-xl">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-green-600"></i>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-800">Welcome to InstaBot AI!</p>
                                <p class="text-sm text-gray-500">Start by connecting your Instagram account</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- AUTOMATION SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="automationSection" class="p-4 lg:p-6 hidden">
                <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Auto DM Settings</h3>
                            <p class="text-sm text-gray-500">Configure your automatic messaging</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="autoDmToggle" class="sr-only peer" onchange="toggleAutoDm()">
                            <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-700" id="autoDmStatus">OFF</span>
                        </label>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Welcome Message (New Followers)</label>
                            <textarea id="welcomeMessage" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600 focus:border-transparent resize-none" placeholder="Hi {name}! Thanks for following me! ðŸ™Œ How can I help you today?"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Use {name} for follower's name, {username} for username</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Auto Reply Message</label>
                            <textarea id="autoReplyMessage" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600 focus:border-transparent resize-none" placeholder="Thanks for your message! I'll get back to you shortly. In the meantime, check out..."></textarea>
                        </div>
                        
                        <div class="grid sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Delay Between DMs (seconds)</label>
                                <input type="number" id="dmDelay" value="30" min="10" max="300" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600">
                                <p class="text-xs text-gray-500 mt-1">Minimum 10 seconds for safety</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Daily DM Limit</label>
                                <input type="number" id="dailyLimit" value="50" min="1" max="500" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600">
                                <p class="text-xs text-gray-500 mt-1">Based on your plan limit</p>
                            </div>
                        </div>
                        
                        <button onclick="saveAutomationSettings()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-lg transition">
                            <i class="fas fa-save mr-2"></i> Save Settings
                        </button>
                    </div>
                </div>
                
                <!-- AI Keyword Responses -->
                <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">AI Keyword Responses</h3>
                    <p class="text-gray-500 text-sm mb-4">Set automatic responses based on keywords in messages</p>
                    
                    <div id="keywordList" class="space-y-3 mb-4">
                        <p class="text-gray-500 text-center py-4">No keywords added yet</p>
                    </div>
                    
                    <div class="grid sm:grid-cols-3 gap-3">
                        <input type="text" id="newKeyword" placeholder="Keyword (e.g., price)" class="px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600">
                        <input type="text" id="newResponse" placeholder="Response message" class="px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600">
                        <button onclick="addKeyword()" class="px-6 py-3 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 transition">
                            <i class="fas fa-plus mr-2"></i> Add
                        </button>
                    </div>
                </div>
                
                <!-- Comment Auto Reply -->
                <div class="glass-card rounded-2xl p-6 shadow-sm">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Comment Auto Reply</h3>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="autoCommentToggle" class="sr-only peer">
                            <div class="w-14 h-7 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Comment Reply Template</label>
                        <textarea id="commentReply" rows="2" class="w-full px-4 py-3 border border-gray-300 rounded-xl resize-none" placeholder="Thanks for your comment! ðŸ™ Check DM for more info."></textarea>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- MESSAGES SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="messagesSection" class="p-4 lg:p-6 hidden">
                <div class="glass-card rounded-2xl shadow-sm overflow-hidden">
                    <div class="flex flex-col md:flex-row h-[600px]">
                        <!-- Conversation List -->
                        <div class="w-full md:w-1/3 border-b md:border-b-0 md:border-r">
                            <div class="p-4 border-b">
                                <input type="text" id="searchMessages" placeholder="Search messages..." class="w-full px-4 py-2 bg-gray-100 rounded-xl focus:ring-2 focus:ring-purple-600 focus:bg-white transition" oninput="searchConversations()">
                            </div>
                            <div id="conversationList" class="overflow-y-auto h-48 md:h-[calc(100%-60px)]">
                                <div class="p-8 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-2 text-gray-300"></i>
                                    <p>No conversations yet</p>
                                    <p class="text-sm mt-1">Connect an Instagram account to start</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chat Area -->
                        <div class="flex-1 flex flex-col">
                            <div id="chatHeader" class="p-4 border-b flex items-center space-x-3 bg-gray-50">
                                <p class="text-gray-500">Select a conversation to start messaging</p>
                            </div>
                            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto bg-gray-50">
                                <!-- Messages loaded here -->
                            </div>
                            <div id="chatInput" class="p-4 border-t bg-white">
                                <div class="flex gap-3">
                                    <input type="text" id="messageInput" placeholder="Type a message..." class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600" disabled>
                                    <button onclick="sendMessage()" id="sendBtn" class="px-6 py-3 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- ANALYTICS SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="analyticsSection" class="p-4 lg:p-6 hidden">
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6">
                    <div class="glass-card rounded-2xl p-4 lg:p-6 shadow-sm">
                        <h4 class="text-gray-500 text-sm mb-2">Today</h4>
                        <p class="text-2xl lg:text-3xl font-bold text-gray-800" id="todayDms">0</p>
                        <p class="text-sm text-gray-500">DMs Sent</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 lg:p-6 shadow-sm">
                        <h4 class="text-gray-500 text-sm mb-2">This Week</h4>
                        <p class="text-2xl lg:text-3xl font-bold text-gray-800" id="weeklyDms">0</p>
                        <p class="text-sm text-gray-500">DMs Sent</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 lg:p-6 shadow-sm">
                        <h4 class="text-gray-500 text-sm mb-2">This Month</h4>
                        <p class="text-2xl lg:text-3xl font-bold text-gray-800" id="monthlyDms">0</p>
                        <p class="text-sm text-gray-500">DMs Sent</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 lg:p-6 shadow-sm">
                        <h4 class="text-gray-500 text-sm mb-2">All Time</h4>
                        <p class="text-2xl lg:text-3xl font-bold text-gray-800" id="allTimeDms">0</p>
                        <p class="text-sm text-gray-500">DMs Sent</p>
                    </div>
                </div>
                
                <div class="grid lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Performance Overview</h3>
                        <div class="h-64">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Message Types</h3>
                        <div class="h-64">
                            <canvas id="messageTypeChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card rounded-2xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Performing Keywords</h3>
                    <div id="topKeywords" class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                            <span class="font-medium">price</span>
                            <span class="text-purple-600 font-medium">245 triggers</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                            <span class="font-medium">hello</span>
                            <span class="text-purple-600 font-medium">189 triggers</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                            <span class="font-medium">help</span>
                            <span class="text-purple-600 font-medium">156 triggers</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- ACCOUNTS SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="accountsSection" class="p-4 lg:p-6 hidden">
                <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Connected Instagram Accounts</h3>
                            <p class="text-sm text-gray-500">Manage your connected accounts</p>
                        </div>
                        <button onclick="openConnectModal()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-lg transition">
                            <i class="fab fa-instagram mr-2"></i> Connect Account
                        </button>
                    </div>
                    
                    <div id="accountsList" class="space-y-4">
                        <div class="text-center py-12 text-gray-500">
                            <i class="fab fa-instagram text-6xl mb-4 text-gray-300"></i>
                            <p class="text-lg font-medium">No accounts connected</p>
                            <p class="text-sm">Connect your Instagram account to start automation</p>
                        </div>
                    </div>
                </div>
                
                <!-- Account Limits Info -->
                <div class="glass-card rounded-2xl p-6 shadow-sm">
                    <h4 class="font-semibold text-gray-800 mb-4">Account Limits by Plan</h4>
                    <div class="grid sm:grid-cols-3 gap-4">
                        <div class="p-4 bg-purple-50 rounded-xl text-center">
                            <p class="text-purple-600 font-semibold">Starter</p>
                            <p class="text-2xl font-bold text-gray-800">1</p>
                            <p class="text-sm text-gray-500">Instagram Account</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl text-center">
                            <p class="text-blue-600 font-semibold">Pro</p>
                            <p class="text-2xl font-bold text-gray-800">3</p>
                            <p class="text-sm text-gray-500">Instagram Accounts</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-xl text-center">
                            <p class="text-green-600 font-semibold">Enterprise</p>
                            <p class="text-2xl font-bold text-gray-800">10</p>
                            <p class="text-sm text-gray-500">Instagram Accounts</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- BILLING SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="billingSection" class="p-4 lg:p-6 hidden">
                <div class="max-w-4xl mx-auto">
                    <!-- Current Plan -->
                    <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Current Plan</h3>
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 gap-4">
                            <div>
                                <p id="billingPlanName" class="text-xl font-bold text-purple-600">Free Plan</p>
                                <p id="billingPlanExpiry" class="text-sm text-gray-500">No expiry</p>
                            </div>
                            <div>
                                <span id="billingPlanBadge" class="px-4 py-2 bg-green-500 text-white rounded-full text-sm font-medium">Active</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <p class="text-2xl font-bold text-gray-800" id="billingDmsUsed">0</p>
                                <p class="text-xs text-gray-500">DMs Used</p>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <p class="text-2xl font-bold text-gray-800" id="billingDmsLimit">100</p>
                                <p class="text-xs text-gray-500">DMs Limit</p>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <p class="text-2xl font-bold text-gray-800" id="billingAccounts">1</p>
                                <p class="text-xs text-gray-500">Accounts</p>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-xl">
                                <p class="text-2xl font-bold text-gray-800" id="billingDaysLeft">âˆž</p>
                                <p class="text-xs text-gray-500">Days Left</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upgrade Plans -->
                    <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Upgrade Your Plan</h3>
                        
                        <!-- Billing Toggle -->
                        <div class="flex justify-center mb-6">
                            <div class="inline-flex items-center bg-gray-100 rounded-full p-1">
                                <button id="billingMonthlyBtn" onclick="switchBillingType('monthly')" class="px-4 sm:px-6 py-2 rounded-full font-medium transition bg-white shadow text-purple-600 text-sm sm:text-base">Monthly</button>
                                <button id="billingYearlyBtn" onclick="switchBillingType('yearly')" class="px-4 sm:px-6 py-2 rounded-full font-medium transition text-gray-600 text-sm sm:text-base">Yearly <span class="text-green-500 text-xs">-20%</span></button>
                            </div>
                        </div>
                        
                        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                            <!-- STARTER PLAN -->
                            <div class="border-2 border-gray-200 rounded-2xl p-6 hover:border-purple-400 transition cursor-pointer" onclick="selectUpgradePlan('starter')">
                                <h4 class="text-xl font-bold text-gray-800">Starter</h4>
                                <p class="text-gray-500 text-sm mb-4">For beginners</p>
                                <p class="text-3xl font-bold text-purple-600 mb-4">
                                    â‚¹<span class="plan-price" data-monthly="499" data-yearly="4790">499</span>
                                    <span class="text-sm text-gray-500 plan-period">/month</span>
                                </p>
                                <ul class="space-y-2 text-sm text-gray-600 mb-6">
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>500 DMs/month</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>1 Instagram Account</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Basic AI Replies</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Email Support</li>
                                </ul>
                                <button class="w-full py-3 border-2 border-purple-600 text-purple-600 rounded-xl font-medium hover:bg-purple-600 hover:text-white transition">
                                    Select Plan
                                </button>
                            </div>
                            
                            <!-- PRO PLAN -->
                            <div class="border-2 border-purple-600 rounded-2xl p-6 relative bg-purple-50/50" onclick="selectUpgradePlan('pro')">
                                <span class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-1 rounded-full text-xs font-bold">POPULAR</span>
                                <h4 class="text-xl font-bold text-gray-800">Pro</h4>
                                <p class="text-gray-500 text-sm mb-4">For growing accounts</p>
                                <p class="text-3xl font-bold text-purple-600 mb-4">
                                    â‚¹<span class="plan-price" data-monthly="999" data-yearly="9590">999</span>
                                    <span class="text-sm text-gray-500 plan-period">/month</span>
                                </p>
                                <ul class="space-y-2 text-sm text-gray-600 mb-6">
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>2000 DMs/month</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>3 Instagram Accounts</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Advanced AI + Analytics</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Priority Support</li>
                                </ul>
                                <button class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-lg transition">
                                    Select Plan
                                </button>
                            </div>
                            
                            <!-- ENTERPRISE PLAN -->
                            <div class="border-2 border-gray-200 rounded-2xl p-6 hover:border-purple-400 transition cursor-pointer sm:col-span-2 lg:col-span-1" onclick="selectUpgradePlan('enterprise')">
                                <h4 class="text-xl font-bold text-gray-800">Enterprise</h4>
                                <p class="text-gray-500 text-sm mb-4">For businesses</p>
                                <p class="text-3xl font-bold text-purple-600 mb-4">
                                    â‚¹<span class="plan-price" data-monthly="2499" data-yearly="23990">2499</span>
                                    <span class="text-sm text-gray-500 plan-period">/month</span>
                                </p>
                                <ul class="space-y-2 text-sm text-gray-600 mb-6">
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Unlimited DMs</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>10 Instagram Accounts</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>API + White Label</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Dedicated Support</li>
                                </ul>
                                <button class="w-full py-3 border-2 border-purple-600 text-purple-600 rounded-xl font-medium hover:bg-purple-600 hover:text-white transition">
                                    Select Plan
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment History -->
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Payment History</h3>
                        <div id="paymentHistory" class="space-y-3">
                            <p class="text-gray-500 text-center py-4">No payment history</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SETTINGS SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="settingsSection" class="p-4 lg:p-6 hidden">
                <div class="max-w-2xl">
                    <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Profile Settings</h3>
                        
                        <div class="flex items-center space-x-4 mb-6">
                            <img id="settingsAvatar" src="https://ui-avatars.com/api/?name=User&background=7c3aed&color=fff&size=80" class="w-20 h-20 rounded-full">
                            <div>
                                <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition">
                                    Change Photo
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                                <input type="text" id="settingsName" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="settingsEmail" class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-100 cursor-not-allowed" disabled>
                                <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone (Optional)</label>
                                <input type="tel" id="settingsPhone" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600" placeholder="+91 XXXXXXXXXX">
                            </div>
                            
                            <button onclick="updateProfile()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-lg transition">
                                <i class="fas fa-save mr-2"></i> Save Changes
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Notification Settings</h3>
                        
                        <div class="space-y-4">
                            <label class="flex items-center justify-between p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                                <div>
                                    <span class="font-medium text-gray-700">Email Notifications</span>
                                    <p class="text-xs text-gray-500">Receive updates via email</p>
                                </div>
                                <input type="checkbox" id="emailNotif" checked class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                            </label>
                            <label class="flex items-center justify-between p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                                <div>
                                    <span class="font-medium text-gray-700">DM Alerts</span>
                                    <p class="text-xs text-gray-500">Get notified for new DMs</p>
                                </div>
                                <input type="checkbox" id="dmNotif" checked class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                            </label>
                            <label class="flex items-center justify-between p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                                <div>
                                    <span class="font-medium text-gray-700">Weekly Report</span>
                                    <p class="text-xs text-gray-500">Receive weekly analytics</p>
                                </div>
                                <input type="checkbox" id="weeklyReport" checked class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                            </label>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold text-red-600 mb-4">Danger Zone</h3>
                        <p class="text-gray-500 text-sm mb-4">These actions are irreversible</p>
                        <div class="flex flex-wrap gap-4">
                            <button onclick="deleteAccount()" class="px-6 py-3 bg-red-100 text-red-600 rounded-xl font-medium hover:bg-red-200 transition">
                                <i class="fas fa-trash mr-2"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- ADMIN SECTION -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <section id="adminSection" class="p-4 lg:p-6 hidden">
                <div class="bg-red-50 border border-red-200 rounded-2xl p-4 mb-6">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-shield-alt text-red-600 text-xl"></i>
                        <div>
                            <h3 class="font-semibold text-red-800">Admin Panel</h3>
                            <p class="text-sm text-red-600">You have administrative access</p>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Stats -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-500 text-sm">Total Users</p>
                        <p id="adminTotalUsers" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-500 text-sm">Paid Users</p>
                        <p id="adminPaidUsers" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-500 text-sm">Total Revenue</p>
                        <p id="adminRevenue" class="text-2xl font-bold text-purple-600">â‚¹0</p>
                    </div>
                    <div class="glass-card rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-500 text-sm">Active Sessions</p>
                        <p id="adminSessions" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                </div>
                
                <!-- User Management -->
                <div class="glass-card rounded-2xl p-6 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">User Management</h3>
                        <button onclick="refreshAdminData()" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-sm font-medium text-gray-600">User</th>
                                    <th class="p-3 text-sm font-medium text-gray-600">Email</th>
                                    <th class="p-3 text-sm font-medium text-gray-600">Plan</th>
                                    <th class="p-3 text-sm font-medium text-gray-600">DMs Used</th>
                                    <th class="p-3 text-sm font-medium text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable" class="divide-y">
                                <tr>
                                    <td colspan="5" class="p-4 text-center text-gray-500">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Pending Payments -->
                <div class="glass-card rounded-2xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Pending UPI Payments</h3>
                    <div id="pendingPayments" class="space-y-3">
                        <p class="text-gray-500 text-center py-4">No pending payments</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MODALS -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- Connect Instagram Modal -->
    <div id="connectModal" class="modal">
        <div class="glass-card rounded-3xl p-6 lg:p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Connect Instagram</h3>
                <button onclick="closeConnectModal()" class="text-gray-400 hover:text-gray-600 p-2">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Instagram Username</label>
                    <input type="text" id="igUsername" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600" placeholder="@yourusername">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Instagram Password</label>
                    <div class="relative">
                        <input type="password" id="igPassword" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-600 pr-12" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        <button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i id="passwordToggleIcon" class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                    <p class="text-yellow-800 text-sm"><i class="fas fa-shield-alt mr-2"></i>Your credentials are encrypted and secure. We use bank-level encryption.</p>
                </div>
                
                <button onclick="connectInstagramAccount()" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold hover:shadow-lg transition">
                    <i class="fab fa-instagram mr-2"></i> Connect Account
                </button>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="glass-card rounded-3xl p-6 lg:p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Complete Payment</h3>
                <button onclick="closePaymentModal()" class="text-gray-400 hover:text-gray-600 p-2">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="text-center mb-6">
                <p class="text-gray-500">You're upgrading to</p>
                <p id="paymentPlanName" class="text-2xl font-bold text-purple-600">Pro Plan</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">â‚¹<span id="paymentAmount">999</span></p>
                <p id="paymentPeriod" class="text-sm text-gray-500">per month</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="payWithRazorpay()" class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                    <img src="https://razorpay.com/favicon.png" class="w-5 h-5" alt="Razorpay"> Pay with Razorpay
                </button>
                
                <button onclick="showUPISection()" class="w-full py-4 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition flex items-center justify-center gap-2">
                    <i class="fas fa-mobile-alt"></i> Pay with UPI
                </button>
                
                <div id="upiSection" class="hidden">
                    <div class="p-4 bg-gray-50 rounded-xl text-center border">
                        <p class="text-sm text-gray-600 mb-2">Scan QR or pay to UPI ID:</p>
                        <p id="displayUpiId" class="font-mono font-bold text-lg text-gray-800">yourstore@upi</p>
                        <img id="upiQR" src="" class="mx-auto mt-4 rounded-lg" alt="UPI QR Code">
                        <div class="mt-4 space-y-3">
                            <input type="text" id="upiTxnId" placeholder="Enter Transaction ID / UTR Number" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-600">
                            <button onclick="verifyUPI()" class="w-full py-3 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 transition">
                                <i class="fas fa-check-circle mr-2"></i> Verify Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Modal -->
    <div id="loadingModal" class="modal">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-white text-lg font-medium" id="loadingText">Please wait...</p>
        </div>
    </div>
    
    <!-- Toast -->
    <div id="toast" class="toast hide fixed bottom-4 right-4 z-50">
        <div class="bg-gray-900 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 max-w-sm">
            <i id="toastIcon" class="fas fa-check-circle text-green-500 text-xl"></i>
            <span id="toastMessage" class="flex-1">Success!</span>
            <button onclick="hideToast()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- Razorpay Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ðŸ”§ CONFIGURATION - EDIT THESE VALUES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const SUPABASE_URL = 'https://uvnksakgjupnivmfkjcv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2bmtzYWtnanVwbml2bWZramN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzM5NzYsImV4cCI6MjA4MTQ0OTk3Nn0.gM5hYGxnUI-n_zM-iut8Dml1T5593YhH5A9HNo8hovA';
        
        // ðŸ’° RAZORPAY - Apna Razorpay Key yahan dalo
        const RAZORPAY_KEY = 'rzp_test_XXXXXXXXXX'; // <- REPLACE WITH YOUR KEY
        
        // ðŸ’° UPI - Apna UPI ID yahan dalo
        const UPI_ID = 'yourstore@upi'; // <- REPLACE WITH YOUR UPI ID
        
        // ðŸ‘¤ ADMIN EMAILS - Admin access ke liye emails
        const ADMIN_EMAILS = [
            'sahanapraveen2006@gmail.com',
            'owner@instabotai.com'
            // Apna email yahan add karo
        ];
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SUPABASE INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GLOBAL VARIABLES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentUser = null;
        let userProfile = null;
        let isAdmin = false;
        let selectedPlan = null;
        let billingType = 'monthly';
        let keywords = [];
        let chartsInitialized = false;
        let dmChart = null;
        let responseChart = null;
        let performanceChart = null;
        let messageTypeChart = null;
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    if (section) {
                        showSection(section);
                        closeSidebar();
                    }
                });
            });
            
            // Close dropdown on outside click
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('userDropdown');
                const button = e.target.closest('button');
                if (!e.target.closest('#userDropdown') && !button?.onclick?.toString().includes('toggleUserDropdown')) {
                    dropdown?.classList.add('hidden');
                }
            });
            
            // Enter key for message input
            document.getElementById('messageInput')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }
        
        async function checkAuth() {
            showLoading('Checking authentication...');
            
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                
                if (!user) {
                    window.location.href = 'index.html';
                    return;
                }
                
                currentUser = user;
                
                // Check if admin
                isAdmin = ADMIN_EMAILS.includes(user.email.toLowerCase());
                
                if (isAdmin) {
                    document.getElementById('adminNavLink').classList.remove('hidden');
                }
                
                await loadUserProfile();
                initCharts();
                
            } catch (error) {
                console.error('Auth error:', error);
                showToast('Authentication error', 'error');
            }
            
            hideLoading();
        }
        
        async function loadUserProfile() {
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (data) {
                    userProfile = data;
                    updateUI();
                } else {
                    // Create profile if doesn't exist
                    const newProfile = {
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || currentUser.email.split('@')[0],
                        plan: 'free',
                        dms_used: 0,
                        dms_limit: 100,
                        is_admin: isAdmin,
                        created_at: new Date().toISOString()
                    };
                    
                    await supabase.from('profiles').insert(newProfile);
                    userProfile = newProfile;
                    updateUI();
                }
            } catch (error) {
                console.error('Profile load error:', error);
            }
        }
        
        function updateUI() {
            if (!userProfile) return;
            
            const name = userProfile.full_name || userProfile.email?.split('@')[0] || 'User';
            
            // Update user info in multiple places
            document.getElementById('userName').textContent = name;
            document.getElementById('settingsName').value = userProfile.full_name || '';
            document.getElementById('settingsEmail').value = userProfile.email || '';
            document.getElementById('settingsPhone').value = userProfile.phone || '';
            document.getElementById('dropdownEmail').textContent = userProfile.email || '';
            
            // Update avatar with initials
            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=7c3aed&color=fff`;
            document.getElementById('userAvatar').src = avatarUrl;
            document.getElementById('settingsAvatar').src = avatarUrl;
            
            // Plan names and limits
            const planNames = { free: 'Free Plan', starter: 'Starter', pro: 'Pro', enterprise: 'Enterprise' };
            const planLimits = { free: 100, starter: 500, pro: 2000, enterprise: 999999 };
            const planLabel = planNames[userProfile.plan] || 'Free Plan';
            
            // Update plan displays
            document.getElementById('currentPlan').textContent = planLabel;
            document.getElementById('billingPlanName').textContent = planLabel;
            document.getElementById('dropdownRole').textContent = planLabel;
            document.getElementById('dmsUsed').textContent = userProfile.dms_used || 0;
            document.getElementById('dmsLimit').textContent = userProfile.plan === 'enterprise' ? 'âˆž' : (planLimits[userProfile.plan] || 100);
            
            // Update billing section
            document.getElementById('billingDmsUsed').textContent = userProfile.dms_used || 0;
            document.getElementById('billingDmsLimit').textContent = userProfile.plan === 'enterprise' ? 'âˆž' : (planLimits[userProfile.plan] || 100);
            
            // Usage bar
            const limit = planLimits[userProfile.plan] || 100;
            const usagePercent = userProfile.plan === 'enterprise' ? 0 : ((userProfile.dms_used || 0) / limit) * 100;
            document.getElementById('usageBar').style.width = `${Math.min(usagePercent, 100)}%`;
            
            // Update stats
            document.getElementById('totalDms').textContent = userProfile.dms_used || 0;
            document.getElementById('totalReplies').textContent = userProfile.auto_replies || 0;
            document.getElementById('allTimeDms').textContent = userProfile.dms_used || 0;
            
            // Load automation settings if exists
            if (userProfile.automation_settings) {
                const settings = userProfile.automation_settings;
                document.getElementById('welcomeMessage').value = settings.welcomeMessage || '';
                document.getElementById('autoReplyMessage').value = settings.autoReplyMessage || '';
                document.getElementById('dmDelay').value = settings.dmDelay || 30;
                document.getElementById('dailyLimit').value = settings.dailyLimit || 50;
                document.getElementById('autoDmToggle').checked = settings.autoDmEnabled || false;
                document.getElementById('autoDmStatus').textContent = settings.autoDmEnabled ? 'ON' : 'OFF';
            }
            
            // Load keywords
            loadKeywords();
            
            // Load connected accounts
            loadConnectedAccounts();
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NAVIGATION - FIXED
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showSection(section) {
            // Hide all sections
            const sections = ['dashboard', 'automation', 'messages', 'analytics', 'accounts', 'billing', 'settings', 'admin'];
            sections.forEach(s => {
                const el = document.getElementById(`${s}Section`);
                if (el) el.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(`${section}Section`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section !== 'admin') {
                    link.classList.add('text-gray-600');
                }
            });
            
            const activeLink = document.querySelector(`.nav-link[data-section="${section}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                activeLink.classList.remove('text-gray-600');
            }
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                automation: 'Automation',
                messages: 'Messages',
                analytics: 'Analytics',
                accounts: 'Instagram Accounts',
                billing: 'Billing',
                settings: 'Settings',
                admin: 'Admin Panel'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
            
            // Initialize specific section
            if (section === 'analytics') {
                setTimeout(initAnalyticsCharts, 100);
            }
            if (section === 'admin' && isAdmin) {
                loadAdminData();
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }
        
        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('hidden');
        }
        
        function closeDropdown() {
            document.getElementById('userDropdown').classList.add('hidden');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTOMATION FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                function toggleAutoDm() {
            const enabled = document.getElementById('autoDmToggle').checked;
            document.getElementById('autoDmStatus').textContent = enabled ? 'ON' : 'OFF';
        }
        
        async function saveAutomationSettings() {
            showLoading('Saving settings...');
            
            const settings = {
                welcomeMessage: document.getElementById('welcomeMessage').value,
                autoReplyMessage: document.getElementById('autoReplyMessage').value,
                dmDelay: parseInt(document.getElementById('dmDelay').value) || 30,
                dailyLimit: parseInt(document.getElementById('dailyLimit').value) || 50,
                autoDmEnabled: document.getElementById('autoDmToggle').checked,
                autoCommentEnabled: document.getElementById('autoCommentToggle').checked,
                commentReply: document.getElementById('commentReply').value
            };
            
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({ automation_settings: settings })
                    .eq('id', currentUser.id);
                
                hideLoading();
                
                if (error) {
                    console.error('Save error:', error);
                    showToast('Error saving settings', 'error');
                } else {
                    userProfile.automation_settings = settings;
                    showToast('Settings saved successfully!');
                }
            } catch (err) {
                hideLoading();
                showToast('Error saving settings', 'error');
            }
        }
        
        async function loadKeywords() {
            try {
                const { data, error } = await supabase
                    .from('keywords')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                keywords = data || [];
                renderKeywords();
            } catch (err) {
                console.error('Keywords load error:', err);
            }
        }
        
        function renderKeywords() {
            const container = document.getElementById('keywordList');
            
            if (!keywords || keywords.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No keywords added yet</p>';
                return;
            }
            
            container.innerHTML = keywords.map(kw => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                    <div class="flex-1 min-w-0">
                        <span class="font-medium text-purple-600">${escapeHtml(kw.keyword)}</span>
                        <span class="text-gray-400 mx-2">â†’</span>
                        <span class="text-gray-600 truncate">${escapeHtml(kw.response)}</span>
                    </div>
                    <button onclick="deleteKeyword('${kw.id}')" class="ml-3 text-red-500 hover:text-red-700 p-2">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }
        
        async function addKeyword() {
            const keyword = document.getElementById('newKeyword').value.trim();
            const response = document.getElementById('newResponse').value.trim();
            
            if (!keyword || !response) {
                showToast('Please fill both keyword and response', 'error');
                return;
            }
            
            showLoading('Adding keyword...');
            
            try {
                const { error } = await supabase.from('keywords').insert({
                    user_id: currentUser.id,
                    keyword: keyword.toLowerCase(),
                    response: response,
                    created_at: new Date().toISOString()
                });
                
                hideLoading();
                
                if (error) {
                    console.error('Add keyword error:', error);
                    showToast('Error adding keyword', 'error');
                } else {
                    document.getElementById('newKeyword').value = '';
                    document.getElementById('newResponse').value = '';
                    await loadKeywords();
                    showToast('Keyword added successfully!');
                }
            } catch (err) {
                hideLoading();
                showToast('Error adding keyword', 'error');
            }
        }
        
        async function deleteKeyword(id) {
            if (!confirm('Delete this keyword?')) return;
            
            try {
                await supabase.from('keywords').delete().eq('id', id);
                await loadKeywords();
                showToast('Keyword deleted');
            } catch (err) {
                showToast('Error deleting keyword', 'error');
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MESSAGES FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function searchConversations() {
            const query = document.getElementById('searchMessages').value.toLowerCase();
            // Filter conversations based on query
            console.log('Searching:', query);
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add message to chat
            console.log('Sending message:', message);
            input.value = '';
            
            showToast('Message sent!');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INSTAGRAM ACCOUNT FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function openConnectModal() {
            document.getElementById('connectModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeConnectModal() {
            document.getElementById('connectModal').classList.remove('active');
            document.body.style.overflow = '';
            // Clear inputs
            document.getElementById('igUsername').value = '';
            document.getElementById('igPassword').value = '';
        }
        
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('igPassword');
            const icon = document.getElementById('passwordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        async function connectInstagramAccount() {
            const username = document.getElementById('igUsername').value.trim().replace('@', '');
            const password = document.getElementById('igPassword').value;
            
            if (!username || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            if (username.length < 3) {
                showToast('Invalid username', 'error');
                return;
            }
            
            showLoading('Connecting account...');
            
            try {
                // Check if account already exists for another user
                const { data: existing } = await supabase
                    .from('instagram_accounts')
                    .select('user_id')
                    .eq('username', username.toLowerCase())
                    .single();
                
                if (existing && existing.user_id !== currentUser.id) {
                    hideLoading();
                    showToast('This account is already connected to another user!', 'error');
                    return;
                }
                
                // Check plan account limits
                const planLimits = { free: 1, starter: 1, pro: 3, enterprise: 10 };
                const maxAccounts = planLimits[userProfile.plan] || 1;
                
                const { data: currentAccounts } = await supabase
                    .from('instagram_accounts')
                    .select('id')
                    .eq('user_id', currentUser.id);
                
                if (currentAccounts && currentAccounts.length >= maxAccounts) {
                    hideLoading();
                    showToast(`Your plan allows only ${maxAccounts} account(s). Upgrade to add more!`, 'error');
                    return;
                }
                
                // Save to database (in production, you'd verify with Instagram API first)
                const { error } = await supabase.from('instagram_accounts').insert({
                    user_id: currentUser.id,
                    username: username.toLowerCase(),
                    status: 'pending', // Will be 'active' after verification
                    created_at: new Date().toISOString()
                });
                
                hideLoading();
                
                if (error) {
                    console.error('Connect error:', error);
                    showToast('Failed to connect account', 'error');
                } else {
                    closeConnectModal();
                    showToast('Account added! Verification pending.');
                    await loadConnectedAccounts();
                }
            } catch (error) {
                hideLoading();
                console.error('Connection error:', error);
                showToast('Connection failed', 'error');
            }
        }
        
        async function loadConnectedAccounts() {
            try {
                const { data, error } = await supabase
                    .from('instagram_accounts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const container = document.getElementById('accountsList');
                
                if (!data || data.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12 text-gray-500">
                            <i class="fab fa-instagram text-6xl mb-4 text-gray-300"></i>
                            <p class="text-lg font-medium">No accounts connected</p>
                            <p class="text-sm">Connect your Instagram account to start automation</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = data.map(acc => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                        <div class="flex items-center space-x-4">
                            <img src="${acc.profile_pic || `https://ui-avatars.com/api/?name=${acc.username}&background=E1306C&color=fff`}" 
                                 class="w-12 h-12 rounded-full object-cover" alt="${acc.username}">
                            <div>
                                <p class="font-medium text-gray-800">@${escapeHtml(acc.username)}</p>
                                <p class="text-sm text-gray-500">${acc.followers || 0} followers</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="px-3 py-1 ${acc.status === 'active' ? 'bg-green-100 text-green-600' : acc.status === 'pending' ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600'} rounded-full text-sm font-medium">
                                ${acc.status === 'active' ? 'Active' : acc.status === 'pending' ? 'Pending' : 'Inactive'}
                            </span>
                            <button onclick="disconnectAccount('${acc.id}')" class="text-red-500 hover:text-red-700 p-2" title="Disconnect">
                                <i class="fas fa-unlink"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Update billing accounts count
                document.getElementById('billingAccounts').textContent = data.length;
                
            } catch (err) {
                console.error('Load accounts error:', err);
            }
        }
        
        async function disconnectAccount(id) {
            if (!confirm('Are you sure you want to disconnect this account?')) return;
            
            try {
                await supabase.from('instagram_accounts').delete().eq('id', id);
                await loadConnectedAccounts();
                showToast('Account disconnected');
            } catch (err) {
                showToast('Error disconnecting account', 'error');
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BILLING & PAYMENT FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function switchBillingType(type) {
            billingType = type;
            
            const monthlyBtn = document.getElementById('billingMonthlyBtn');
            const yearlyBtn = document.getElementById('billingYearlyBtn');
            
            if (type === 'monthly') {
                monthlyBtn.classList.add('bg-white', 'shadow', 'text-purple-600');
                monthlyBtn.classList.remove('text-gray-600');
                yearlyBtn.classList.remove('bg-white', 'shadow', 'text-purple-600');
                yearlyBtn.classList.add('text-gray-600');
            } else {
                yearlyBtn.classList.add('bg-white', 'shadow', 'text-purple-600');
                yearlyBtn.classList.remove('text-gray-600');
                monthlyBtn.classList.remove('bg-white', 'shadow', 'text-purple-600');
                monthlyBtn.classList.add('text-gray-600');
            }
            
            // Update prices
            document.querySelectorAll('.plan-price').forEach(el => {
                el.textContent = el.dataset[type];
            });
            
            document.querySelectorAll('.plan-period').forEach(el => {
                el.textContent = type === 'monthly' ? '/month' : '/year';
            });
        }
        
        function selectUpgradePlan(plan) {
            selectedPlan = plan;
            
            const prices = {
                starter: { monthly: 499, yearly: 4790 },
                pro: { monthly: 999, yearly: 9590 },
                enterprise: { monthly: 2499, yearly: 23990 }
            };
            
            const planNames = { starter: 'Starter', pro: 'Pro', enterprise: 'Enterprise' };
            
            document.getElementById('paymentPlanName').textContent = planNames[plan] + ' Plan';
            document.getElementById('paymentAmount').textContent = prices[plan][billingType];
            document.getElementById('paymentPeriod').textContent = billingType === 'monthly' ? 'per month' : 'per year';
            
            // Reset UPI section
            document.getElementById('upiSection').classList.add('hidden');
            
            document.getElementById('paymentModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('upiSection').classList.add('hidden');
            document.getElementById('upiTxnId').value = '';
        }
        
        function payWithRazorpay() {
            const prices = {
                starter: { monthly: 499, yearly: 4790 },
                pro: { monthly: 999, yearly: 9590 },
                enterprise: { monthly: 2499, yearly: 23990 }
            };
            
            const amount = prices[selectedPlan][billingType] * 100; // Razorpay uses paise
            const planNames = { starter: 'Starter', pro: 'Pro', enterprise: 'Enterprise' };
            
            const options = {
                key: RAZORPAY_KEY,
                amount: amount,
                currency: 'INR',
                name: 'InstaBot AI',
                description: `${planNames[selectedPlan]} Plan - ${billingType}`,
                image: 'https://ui-avatars.com/api/?name=IB&background=7c3aed&color=fff',
                handler: async function(response) {
                    await verifyRazorpayPayment(response.razorpay_payment_id);
                },
                prefill: {
                    email: currentUser.email,
                    name: userProfile?.full_name || ''
                },
                theme: {
                    color: '#7c3aed'
                },
                modal: {
                    ondismiss: function() {
                        console.log('Payment cancelled');
                    }
                }
            };
            
            try {
                const rzp = new Razorpay(options);
                rzp.open();
            } catch (err) {
                console.error('Razorpay error:', err);
                showToast('Payment initialization failed. Check Razorpay key.', 'error');
            }
        }
        
        async function verifyRazorpayPayment(paymentId) {
            showLoading('Verifying payment...');
            
            try {
                // In production, verify payment on your server
                // For now, we'll update the plan directly
                
                const planLimits = { starter: 500, pro: 2000, enterprise: 999999 };
                const expiryDate = new Date();
                if (billingType === 'monthly') {
                    expiryDate.setMonth(expiryDate.getMonth() + 1);
                } else {
                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                }
                
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        plan: selectedPlan,
                        dms_limit: planLimits[selectedPlan],
                        plan_expiry: expiryDate.toISOString(),
                        last_payment_id: paymentId,
                        last_payment_date: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                // Log payment
                await supabase.from('payments').insert({
                    user_id: currentUser.id,
                    plan: selectedPlan,
                    amount: document.getElementById('paymentAmount').textContent,
                    billing_type: billingType,
                    payment_id: paymentId,
                    payment_method: 'razorpay',
                    status: 'completed',
                    created_at: new Date().toISOString()
                });
                
                hideLoading();
                
                if (error) {
                    showToast('Error updating plan', 'error');
                } else {
                    closePaymentModal();
                    showToast('Payment successful! Plan upgraded.');
                    await loadUserProfile();
                }
            } catch (error) {
                hideLoading();
                console.error('Verify error:', error);
                showToast('Error verifying payment', 'error');
            }
        }
        
        function showUPISection() {
            const upiSection = document.getElementById('upiSection');
            upiSection.classList.remove('hidden');
            
            const prices = {
                starter: { monthly: 499, yearly: 4790 },
                pro: { monthly: 999, yearly: 9590 },
                enterprise: { monthly: 2499, yearly: 23990 }
            };
            
            const amount = prices[selectedPlan][billingType];
            const upiLink = `upi://pay?pa=${UPI_ID}&pn=InstaBot%20AI&am=${amount}&cu=INR&tn=Plan%20Upgrade`;
            
            document.getElementById('displayUpiId').textContent = UPI_ID;
            document.getElementById('upiQR').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(upiLink)}`;
        }
        
        async function verifyUPI() {
            const txnId = document.getElementById('upiTxnId').value.trim();
            
            if (!txnId) {
                showToast('Please enter Transaction ID / UTR Number', 'error');
                return;
            }
            
            if (txnId.length < 6) {
                showToast('Invalid Transaction ID', 'error');
                return;
            }
            
            showLoading('Submitting for verification...');
            
            try {
                // Log pending payment for admin verification
                await supabase.from('payments').insert({
                    user_id: currentUser.id,
                    plan: selectedPlan,
                    amount: document.getElementById('paymentAmount').textContent,
                    billing_type: billingType,
                    payment_id: txnId,
                    payment_method: 'upi',
                    status: 'pending',
                    created_at: new Date().toISOString()
                });
                
                hideLoading();
                closePaymentModal();
                showToast('Payment submitted! Plan will be activated within 24 hours after verification.');
                
            } catch (error) {
                hideLoading();
                console.error('UPI verify error:', error);
                showToast('Error submitting payment', 'error');
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PROFILE & SETTINGS FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function updateProfile() {
            const name = document.getElementById('settingsName').value.trim();
            const phone = document.getElementById('settingsPhone').value.trim();
            
            if (!name) {
                showToast('Name cannot be empty', 'error');
                return;
            }
            
            showLoading('Updating profile...');
            
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        full_name: name,
                        phone: phone,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                hideLoading();
                
                if (error) {
                    showToast('Error updating profile', 'error');
                } else {
                    showToast('Profile updated successfully!');
                    await loadUserProfile();
                }
            } catch (err) {
                hideLoading();
                showToast('Error updating profile', 'error');
            }
        }
        
        async function deleteAccount() {
            if (!confirm('âš ï¸ Are you sure you want to delete your account?\n\nThis action CANNOT be undone!')) return;
            if (!confirm('All your data, connected accounts, and settings will be permanently deleted.\n\nType "DELETE" to confirm:')) return;
            
            showLoading('Deleting account...');
            
            try {
                // Delete all related data
                await supabase.from('keywords').delete().eq('user_id', currentUser.id);
                await supabase.from('instagram_accounts').delete().eq('user_id', currentUser.id);
                await supabase.from('payments').delete().eq('user_id', currentUser.id);
                await supabase.from('profiles').delete().eq('id', currentUser.id);
                
                // Sign out
                await supabase.auth.signOut();
                
                window.location.href = 'index.html';
            } catch (err) {
                hideLoading();
                console.error('Delete error:', err);
                showToast('Error deleting account', 'error');
            }
        }
        
        async function logout() {
            showLoading('Logging out...');
            try {
                await supabase.auth.signOut();
                window.location.href = 'index.html';
            } catch (err) {
                hideLoading();
                window.location.href = 'index.html';
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ADMIN FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadAdminData() {
            if (!isAdmin) return;
            
            try {
                // Load all users
                const { data: users, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                // Update stats
                document.getElementById('adminTotalUsers').textContent = users?.length || 0;
                document.getElementById('adminPaidUsers').textContent = users?.filter(u => u.plan !== 'free').length || 0;
                
                // Load payments for revenue
                const { data: payments } = await supabase
                    .from('payments')
                    .select('amount')
                    .eq('status', 'completed');
                
                const totalRevenue = payments?.reduce((sum, p) => sum + (parseInt(p.amount) || 0), 0) || 0;
                document.getElementById('adminRevenue').textContent = `â‚¹${totalRevenue.toLocaleString()}`;
                
                // Render users table
                const tableBody = document.getElementById('adminUsersTable');
                
                if (!users || users.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">No users found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = users.map(user => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">
                            <div class="flex items-center gap-2">
                                <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(user.full_name || 'U')}&background=7c3aed&color=fff&size=32" class="w-8 h-8 rounded-full">
                                <span class="font-medium">${escapeHtml(user.full_name || 'Unknown')}</span>
                            </div>
                        </td>
                        <td class="p-3 text-gray-600">${escapeHtml(user.email)}</td>
                        <td class="p-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                user.plan === 'enterprise' ? 'bg-green-100 text-green-600' :
                                user.plan === 'pro' ? 'bg-purple-100 text-purple-600' :
                                user.plan === 'starter' ? 'bg-blue-100 text-blue-600' :
                                'bg-gray-100 text-gray-600'
                            }">${user.plan?.toUpperCase() || 'FREE'}</span>
                        </td>
                        <td class="p-3">${user.dms_used || 0}</td>
                        <td class="p-3">
                            <button onclick="adminEditUser('${user.id}')" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="adminDeleteUser('${user.id}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Load pending payments
                await loadPendingPayments();
                
            } catch (err) {
                console.error('Admin data error:', err);
            }
        }
        
        async function loadPendingPayments() {
            try {
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*, profiles(email, full_name)')
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });
                
                const container = document.getElementById('pendingPayments');
                
                if (!payments || payments.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">No pending payments</p>';
                    return;
                }
                
                container.innerHTML = payments.map(p => `
                    <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                        <div>
                            <p class="font-medium">${escapeHtml(p.profiles?.full_name || 'Unknown')}</p>
                            <p class="text-sm text-gray-600">${p.profiles?.email}</p>
                            <p class="text-sm text-gray-500">Plan: ${p.plan} | Amount: â‚¹${p.amount} | TXN: ${p.payment_id}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="approvePayment('${p.id}', '${p.user_id}', '${p.plan}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                <i class="fas fa-check mr-1"></i> Approve
                            </button>
                            <button onclick="rejectPayment('${p.id}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                <i class="fas fa-times mr-1"></i> Reject
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Pending payments error:', err);
            }
        }
        
        async function approvePayment(paymentId, userId, plan) {
            if (!confirm('Approve this payment?')) return;
            
            showLoading('Approving payment...');
            
            try {
                const planLimits = { starter: 500, pro: 2000, enterprise: 999999 };
                
                // Update user plan
                await supabase
                    .from('profiles')
                    .update({
                        plan: plan,
                        dms_limit: planLimits[plan]
                    })
                    .eq('id', userId);
                
                // Update payment status
                await supabase
                    .from('payments')
                    .update({ status: 'completed' })
                    .eq('id', paymentId);
                
                hideLoading();
                showToast('Payment approved!');
                await loadAdminData();
                
            } catch (err) {
                hideLoading();
                showToast('Error approving payment', 'error');
            }
        }
        
        async function rejectPayment(paymentId) {
            if (!confirm('Reject this payment?')) return;
            
            try {
                await supabase
                    .from('payments')
                    .update({ status: 'rejected' })
                    .eq('id', paymentId);
                
                showToast('Payment rejected');
                await loadAdminData();
                
            } catch (err) {
                showToast('Error rejecting payment', 'error');
            }
        }
        
        function adminEditUser(userId) {
            // Implement user edit modal
            alert('Edit user: ' + userId);
        }
        
        async function adminDeleteUser(userId) {
            if (!confirm('Delete this user and all their data?')) return;
            
            try {
                await supabase.from('keywords').delete().eq('user_id', userId);
                await supabase.from('instagram_accounts').delete().eq('user_id', userId);
                await supabase.from('payments').delete().eq('user_id', userId);
                await supabase.from('profiles').delete().eq('id', userId);
                
                showToast('User deleted');
                await loadAdminData();
            } catch (err) {
                showToast('Error deleting user', 'error');
            }
        }
        
        function refreshAdminData() {
            loadAdminData();
            showToast('Data refreshed');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CHARTS - FIXED
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initCharts() {
            if (chartsInitialized) return;
            
            // Wait for DOM to be ready
            setTimeout(() => {
                try {
                    // DM Activity Chart
                    const dmCtx = document.getElementById('dmChart');
                    if (dmCtx) {
                        if (dmChart) dmChart.destroy();
                        dmChart = new Chart(dmCtx.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                                datasets: [{
                                    label: 'DMs Sent',
                                    data: [12, 19, 15, 25, 22, 30, 28],
                                    borderColor: '#7c3aed',
                                    backgroundColor: 'rgba(124, 58, 237, 0.1)',
                                    fill: true,
                                    tension: 0.4,
                                    borderWidth: 2,
                                    pointBackgroundColor: '#7c3aed',
                                    pointRadius: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { 
                                    legend: { display: false } 
                                },
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });
                    }
                    
                    // Response Chart
                    const respCtx = document.getElementById('responseChart');
                    if (respCtx) {
                        if (responseChart) responseChart.destroy();
                        responseChart = new Chart(respCtx.getContext('2d'), {
                            type: 'doughnut',
                            data: {
                                labels: ['Replied', 'No Reply', 'Pending'],
                                datasets: [{
                                    data: [65, 25, 10],
                                    backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { 
                                    legend: { 
                                        position: 'bottom',
                                        labels: {
                                            padding: 20,
                                            usePointStyle: true
                                        }
                                    } 
                                },
                                cutout: '60%'
                            }
                        });
                    }
                    
                    chartsInitialized = true;
                } catch (err) {
                    console.error('Chart init error:', err);
                }
            }, 200);
        }
        
        function initAnalyticsCharts() {
            setTimeout(() => {
                try {
                    // Performance Chart
                    const perfCtx = document.getElementById('performanceChart');
                    if (perfCtx) {
                        if (performanceChart) performanceChart.destroy();
                        performanceChart = new Chart(perfCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                                datasets: [{
                                    label: 'DMs Sent',
                                    data: [150, 220, 180, 290],
                                    backgroundColor: '#7c3aed',
                                    borderRadius: 8
                                }, {
                                    label: 'Replies Received',
                                    data: [80, 120, 95, 160],
                                    backgroundColor: '#ec4899',
                                    borderRadius: 8
                                }]
                            },
                            options: { 
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top'
                                    }
                                },
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });
                    }
                    
                    // Message Type Chart
                    const msgCtx = document.getElementById('messageTypeChart');
                    if (msgCtx) {
                        if (messageTypeChart) messageTypeChart.destroy();
                        messageTypeChart = new Chart(msgCtx.getContext('2d'), {
                            type: 'pie',
                            data: {
                                labels: ['Welcome DMs', 'Auto Replies', 'Keyword Replies', 'Manual'],
                                datasets: [{
                                    data: [40, 30, 20, 10],
                                    backgroundColor: ['#7c3aed', '#ec4899', '#10b981', '#f59e0b'],
                                    borderWidth: 0
                                }]
                            },
                            options: { 
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            usePointStyle: true
                                        }
                                    }
                                }
                            }
                        });
                    }
                } catch (err) {
                    console.error('Analytics chart error:', err);
                }
            }, 100);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITY FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showLoading(text = 'Please wait...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingModal').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loadingModal').classList.remove('active');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');
            
            msg.textContent = message;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle text-green-500 text-xl';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle text-red-500 text-xl';
            } else {
                icon.className = 'fas fa-info-circle text-blue-500 text-xl';
            }
            
            toast.classList.remove('hide');
            toast.classList.add('show');
            
            setTimeout(() => {
                hideToast();
            }, 4000);
        }
        
        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
            toast.classList.add('hide');
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Handle escape key to close modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeConnectModal();
                closePaymentModal();
                closeSidebar();
            }
        });
    </script>
</body>
</html>
