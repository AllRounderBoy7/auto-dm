<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaBot Pro - Instagram Automation Platform</title>
    
    <!-- External CDN Links -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--darker);
            color: var(--light);
            overflow-x: hidden;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float 20s infinite ease-in-out;
            z-index: 1;
        }

        .orb1 {
            width: 400px;
            height: 400px;
            background: var(--primary);
            top: -200px;
            left: -200px;
        }

        .orb2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -250px;
            right: -250px;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 50px) scale(1.1); }
        }

        .container {
            position: relative;
            z-index: 2;
            min-height: 100vh;
        }

        /* Glass Card */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--glass);
            color: var(--light);
            border: 1px solid var(--glass-border);
        }

        /* Landing Page */
        .landing-page {
            display: block;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero {
            text-align: center;
            padding: 100px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 20px;
            color: #94a3b8;
            margin-bottom: 40px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 80px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            text-align: center;
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pricing {
            padding: 80px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .pricing h2 {
            text-align: center;
            font-size: 42px;
            margin-bottom: 50px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .pricing-card {
            text-align: center;
            position: relative;
        }

        .pricing-card.popular {
            border: 2px solid var(--primary);
        }

        .price {
            font-size: 48px;
            font-weight: 700;
            margin: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-list {
            list-style: none;
            margin: 30px 0;
            text-align: left;
        }

        .feature-list li {
            padding: 10px 0;
            color: #94a3b8;
        }

        .feature-list i {
            color: var(--primary);
            margin-right: 10px;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--glass-border);
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar-header {
            margin-bottom: 40px;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .main-content {
            margin-left: 250px;
            padding: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            font-size: 36px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .stat-info h3 {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-info p {
            color: #94a3b8;
            font-size: 14px;
        }

        /* Table */
        .table-container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
        }

        th {
            background: rgba(99, 102, 241, 0.1);
            font-weight: 600;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--dark);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: var(--glass);
            color: var(--light);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        select.form-control {
            cursor: pointer;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: 0.4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-free {
            background: #334155;
            color: #94a3b8;
        }

        .badge-pro {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .badge-master {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: white;
        }

        .badge-active {
            background: #10b981;
            color: white;
        }

        .badge-inactive {
            background: #ef4444;
            color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 8px;
            background: var(--dark);
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.warning {
            border-left: 4px solid #f59e0b;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--glass-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Section Visibility */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 20px;
            }

            .hero h1 {
                font-size: 36px;
            }

            .hero p {
                font-size: 16px;
            }

            .features, .pricing {
                padding: 40px 20px;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .mobile-menu-btn {
                display: block;
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary), var(--secondary));
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                z-index: 100;
            }
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <!-- Floating Orbs -->
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <nav class="navbar">
            <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
            <button class="btn btn-primary" onclick="loginWithGoogle()">
                <i class="fab fa-google"></i> Login with Google
            </button>
        </nav>

        <section class="hero animate__animated animate__fadeIn">
            <h1>Automate Your Instagram DMs</h1>
            <p>The most powerful Instagram automation platform for businesses</p>
            <button class="btn btn-primary" onclick="loginWithGoogle()">Get Started Free</button>
        </section>

        <section class="features">
            <div class="glass-card feature-card animate__animated animate__fadeInUp">
                <div class="feature-icon"><i class="fas fa-robot"></i></div>
                <h3>Smart Automation</h3>
                <p>Auto-reply to DMs, comments, and story mentions with intelligent triggers</p>
            </div>
            <div class="glass-card feature-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                <div class="feature-icon"><i class="fas fa-users"></i></div>
                <h3>Contact Management</h3>
                <p>Organize unlimited contacts with tags and advanced filtering</p>
            </div>
            <div class="glass-card feature-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Analytics Dashboard</h3>
                <p>Track engagement, response rates, and automation performance</p>
            </div>
        </section>

        <section class="pricing">
            <h2>Choose Your Plan</h2>
            <div class="pricing-grid">
                <div class="glass-card pricing-card animate__animated animate__fadeInUp">
                    <h3>Free</h3>
                    <div class="price">₹0<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 1,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 3 Automations</li>
                        <li><i class="fas fa-check"></i> 1 Team Member</li>
                        <li><i class="fas fa-check"></i> Basic Analytics</li>
                    </ul>
                    <button class="btn btn-secondary" onclick="loginWithGoogle()">Get Started</button>
                </div>

                <div class="glass-card pricing-card popular animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                    <h3>Pro</h3>
                    <div class="price">₹199<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 25 Automations</li>
                        <li><i class="fas fa-check"></i> 5 Team Members</li>
                        <li><i class="fas fa-check"></i> Advanced Analytics</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()">Start Pro</button>
                </div>

                <div class="glass-card pricing-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                    <h3>Master</h3>
                    <div class="price">₹499<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Unlimited Contacts</li>
                        <li><i class="fas fa-check"></i> Unlimited Automations</li>
                        <li><i class="fas fa-check"></i> Unlimited Team</li>
                        <li><i class="fas fa-check"></i> Premium Analytics</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()">Start Master</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
            </div>
            <nav>
                <div class="nav-item active" onclick="showSection('dashboardSection')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" onclick="showSection('automationsSection')">
                    <i class="fas fa-robot"></i> Automations
                </div>
                <div class="nav-item" onclick="showSection('contactsSection')">
                    <i class="fas fa-users"></i> Contacts
                </div>
                <div class="nav-item" onclick="showSection('inboxSection')">
                    <i class="fas fa-inbox"></i> Inbox
                </div>
                <div class="nav-item" onclick="showSection('analyticsSection')">
                    <i class="fas fa-chart-bar"></i> Analytics
                </div>
                <div class="nav-item" onclick="showSection('billingSection')">
                    <i class="fas fa-credit-card"></i> Billing
                </div>
                <div class="nav-item" onclick="showSection('settingsSection')">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-item hidden" id="adminNav" onclick="showSection('adminSection')">
                    <i class="fas fa-crown"></i> Admin Panel
                </div>
                <div class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Dashboard Section -->
            <div class="section active" id="dashboardSection">
                <h1 class="mb-20">Dashboard</h1>
                <div class="stats-grid">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="totalContacts">0</h3>
                            <p>Total Contacts</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-robot"></i></div>
                        <div class="stat-info">
                            <h3 id="totalAutomations">0</h3>
                            <p>Automations</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-paper-plane"></i></div>
                        <div class="stat-info">
                            <h3 id="messagesSent">0</h3>
                            <p>Messages Sent</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                        <div class="stat-info">
                            <h3 id="todayTriggers">0</h3>
                            <p>Today's Triggers</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card mt-20">
                    <h2>Quick Actions</h2>
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showModal('createAutomationModal')">
                            <i class="fas fa-plus"></i> Create Automation
                        </button>
                        <button class="btn btn-primary" onclick="showModal('addContactModal')">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </button>
                        <button class="btn btn-secondary" onclick="showSection('billingSection')">
                            <i class="fas fa-crown"></i> Upgrade Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Automations Section -->
            <div class="section" id="automationsSection">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1>Automations</h1>
                    <button class="btn btn-primary" onclick="showModal('createAutomationModal')">
                        <i class="fas fa-plus"></i> Create Automation
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Trigger</th>
                                <th>Status</th>
                                <th>Stats</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="automationsTable">
                            <tr>
                                <td colspan="5" class="text-center">No automations yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contacts Section -->
            <div class="section" id="contactsSection">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1>Contacts</h1>
                    <button class="btn btn-primary" onclick="showModal('addContactModal')">
                        <i class="fas fa-user-plus"></i> Add Contact
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Tags</th>
                                <th>Last Message</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTable">
                            <tr>
                                <td colspan="4" class="text-center">No contacts yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inbox Section -->
            <div class="section" id="inboxSection">
                <h1 class="mb-20">Inbox</h1>
                <div class="glass-card">
                    <p class="text-center" style="color: #94a3b8;">Connect your Instagram account to view messages</p>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="section" id="analyticsSection">
                <h1 class="mb-20">Analytics</h1>
                <div class="glass-card">
                    <p class="text-center" style="color: #94a3b8;">Analytics available in Pro and Master plans</p>
                </div>
            </div>

            <!-- Billing Section -->
            <div class="section" id="billingSection">
                <h1 class="mb-20">Billing</h1>
                <div class="glass-card mb-20">
                    <h2>Current Plan: <span id="currentPlan" class="badge badge-free">Free</span></h2>
                    <p style="color: #94a3b8; margin-top: 10px;">Expiry: <span id="planExpiry">-</span></p>
                </div>

                <div class="pricing-grid mb-20">
                    <div class="glass-card pricing-card">
                        <h3>Pro Plan</h3>
                        <div class="price">₹199<span style="font-size: 18px;">/month</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                            <li><i class="fas fa-check"></i> 25 Automations</li>
                            <li><i class="fas fa-check"></i> 5 Team Members</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('pro', 199)">Upgrade to Pro</button>
                    </div>

                    <div class="glass-card pricing-card">
                        <h3>Master Plan</h3>
                        <div class="price">₹499<span style="font-size: 18px;">/month</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Unlimited Contacts</li>
                            <li><i class="fas fa-check"></i> Unlimited Automations</li>
                            <li><i class="fas fa-check"></i> Unlimited Team</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('master', 499)">Upgrade to Master</button>
                    </div>
                </div>

                <div class="glass-card">
                    <h2 class="mb-20">Payment History</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Plan</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistory">
                                <tr>
                                    <td colspan="4" class="text-center">No payment history</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settingsSection">
                <h1 class="mb-20">Settings</h1>
                <div class="glass-card">
                    <h2>Profile Information</h2>
                    <div class="form-group mt-20">
                        <label>Name</label>
                        <input type="text" class="form-control" id="settingsName" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="settingsEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label>Instagram Connected</label>
                        <p id="instaStatus" style="color: #94a3b8;">Not connected</p>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div class="section" id="adminSection">
                <h1 class="mb-20">Admin Panel</h1>
                
                <div class="stats-grid mb-20">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="adminTotalUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <h3 id="adminRevenue">₹0</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-crown"></i></div>
                        <div class="stat-info">
                            <h3 id="adminProUsers">0</h3>
                            <p>Pro Users</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card mb-20">
                    <h2>Manage Plans</h2>
                    <button class="btn btn-primary mt-20" onclick="showModal('editPlanModal')">
                        <i class="fas fa-edit"></i> Edit Plans
                    </button>
                </div>

                <div class="glass-card">
                    <h2 class="mb-20">All Users</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Plan</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <tr>
                                    <td colspan="5" class="text-center">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Create Automation Modal -->
    <div class="modal" id="createAutomationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Automation</h2>
                <span class="close" onclick="hideModal('createAutomationModal')">&times;</span>
            </div>
            <form onsubmit="createAutomation(event)">
                <div class="form-group">
                    <label>Automation Name</label>
                    <input type="text" class="form-control" id="automationName" required>
                </div>
                <div class="form-group">
                    <label>Trigger Type</label>
                    <select class="form-control" id="triggerType" required>
                        <option value="keyword_dm">Keyword in DM</option>
                        <option value="keyword_comment">Keyword in Comment</option>
                        <option value="story_mention">Story Mention</option>
                        <option value="first_message">First Message</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Trigger Keywords (comma separated)</label>
                    <input type="text" class="form-control" id="triggerKeywords" placeholder="hi, hello, price" required>
                </div>
                <div class="form-group">
                    <label>Response Message</label>
                    <textarea class="form-control" id="responseMessage" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Create Automation</button>
            </form>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div class="modal" id="addContactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Contact</h2>
                <span class="close" onclick="hideModal('addContactModal')">&times;</span>
            </div>
            <form onsubmit="addContact(event)">
                <div class="form-group">
                    <label>Instagram Username</label>
                    <input type="text" class="form-control" id="contactUsername" required>
                </div>
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" class="form-control" id="contactTags" placeholder="customer, vip, interested">
                </div>
                <button type="submit" class="btn btn-primary">Add Contact</button>
            </form>
        </div>
    </div>

    <!-- Edit Plan Modal (Admin) -->
    <div class="modal" id="editPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Plans</h2>
                <span class="close" onclick="hideModal('editPlanModal')">&times;</span>
            </div>
            <form onsubmit="updatePlans(event)">
                <h3>Free Plan</h3>
                <div class="form-group">
                    <label>Contacts Limit</label>
                    <input type="number" class="form-control" id="freeLimitContacts" value="1000">
                </div>
                <div class="form-group">
                    <label>Automations Limit</label>
                    <input type="number" class="form-control" id="freeLimitAuto" value="3">
                </div>

                <h3 class="mt-20">Pro Plan</h3>
                <div class="form-group">
                    <label>Price (₹)</label>
                    <input type="number" class="form-control" id="proPrice" value="199">
                </div>
                <div class="form-group">
                    <label>Contacts Limit</label>
                    <input type="number" class="form-control" id="proLimitContacts" value="10000">
                </div>
                <div class="form-group">
                    <label>Automations Limit</label>
                    <input type="number" class="form-control" id="proLimitAuto" value="25">
                </div>

                <h3 class="mt-20">Master Plan</h3>
                <div class="form-group">
                    <label>Price (₹)</label>
                    <input type="number" class="form-control" id="masterPrice" value="499">
                </div>
                <div class="form-group">
                    <label>Contacts Limit (-1 for unlimited)</label>
                    <input type="number" class="form-control" id="masterLimitContacts" value="-1">
                </div>
                <div class="form-group">
                    <label>Automations Limit (-1 for unlimited)</label>
                    <input type="number" class="form-control" id="masterLimitAuto" value="-1">
                </div>

                <button type="submit" class="btn btn-primary">Update Plans</button>
            </form>
        </div>
    </div>

    <!-- Change User Plan Modal (Admin) -->
    <div class="modal" id="changeUserPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Change User Plan</h2>
                <span class="close" onclick="hideModal('changeUserPlanModal')">&times;</span>
            </div>
            <form onsubmit="changeUserPlan(event)">
                <input type="hidden" id="changeUserId">
                <div class="form-group">
                    <label>User: <span id="changeUserName"></span></label>
                </div>
                <div class="form-group">
                    <label>New Plan</label>
                    <select class="form-control" id="newPlanType" required>
                        <option value="free">Free</option>
                        <option value="pro">Pro</option>
                        <option value="master">Master</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Change Plan</button>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ============================================
        const SUPABASE_URL = 'https://uvnksakgjupnivmfkjcv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2bmtzYWtnanVwbml2bWZramN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzM5NzYsImV4cCI6MjA4MTQ0OTk3Nn0.gM5hYGxnUI-n_zM-iut8Dml1T5593YhH5A9HNo8hovA';
        const UPI_ID = 'your-upi@ybl';  // UPDATE THIS WITH YOUR UPI ID
        
        // ============================================
        // Initialize Supabase Client
        // ============================================
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let userPlanLimits = {
            contacts: 1000,
            automations: 3
        };

        // ============================================
        // Initialize Particles.js
        // ============================================
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#6366f1' },
                shape: { type: 'circle' },
                opacity: { value: 0.5, random: false },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#6366f1',
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: 'none',
                    random: false,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'repulse' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                }
            },
            retina_detect: true
        });

        // ============================================
        // Authentication Functions
        // ============================================
        async function loginWithGoogle() {
            try {
                showLoading();
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin
                    }
                });
                
                if (error) throw error;
            } catch (error) {
                hideLoading();
                showToast('Login failed: ' + error.message, 'error');
            }
        }

        async function logout() {
            try {
                showLoading();
                await supabase.auth.signOut();
                currentUser = null;
                document.getElementById('landingPage').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                hideLoading();
                showToast('Logged out successfully', 'success');
            } catch (error) {
                hideLoading();
                showToast('Logout failed: ' + error.message, 'error');
            }
        }

        // ============================================
        // Check Authentication State
        // ============================================
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                await handleUserLogin(session.user);
            } else {
                document.getElementById('landingPage').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        async function handleUserLogin(user) {
            try {
                showLoading();
                
                // Check if user exists in database
                const { data: existingUser, error: fetchError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', user.id)
                    .single();

                if (fetchError && fetchError.code !== 'PGRST116') throw fetchError;

                // Create user if doesn't exist
                if (!existingUser) {
                    const { error: insertError } = await supabase
                        .from('users')
                        .insert({
                            id: user.id,
                            email: user.email,
                            name: user.user_metadata.full_name || user.email.split('@')[0],
                            avatar_url: user.user_metadata.avatar_url,
                            google_id: user.user_metadata.sub,
                            plan_type: 'free',
                            plan_expiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                            created_at: new Date().toISOString()
                        });

                    if (insertError) throw insertError;

                    // Fetch the newly created user
                    const { data: newUser } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    currentUser = newUser;
                } else {
                    currentUser = existingUser;
                }

                // Load plan limits
                await loadPlanLimits();

                // Show dashboard
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';

                // Show admin nav if admin
                if (currentUser.is_admin) {
                    document.getElementById('adminNav').classList.remove('hidden');
                }

                // Load dashboard data
                await loadDashboard();
                
                hideLoading();
                showToast('Welcome, ' + currentUser.name + '!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error loading user: ' + error.message, 'error');
                console.error(error);
            }
        }

        // ============================================
        // Load Plan Limits
        // ============================================
        async function loadPlanLimits() {
            try {
                const { data: plans, error } = await supabase
                    .from('plans')
                    .select('*')
                    .eq('name', currentUser.plan_type)
                    .single();

                if (error) throw error;

                userPlanLimits = {
                    contacts: plans.contacts_limit,
                    automations: plans.automations_limit
                };
            } catch (error) {
                console.error('Error loading plan limits:', error);
            }
        }

        // ============================================
        // Dashboard Functions
        // ============================================
        async function loadDashboard() {
            try {
                // Load stats
                const { data: contacts } = await supabase
                    .from('contacts')
                    .select('id', { count: 'exact' })
                    .eq('user_id', currentUser.id);

                const { data: automations } = await supabase
                    .from('automations')
                    .select('id, stats', { count: 'exact' })
                    .eq('user_id', currentUser.id);

                let totalTriggered = 0;
                let todayTriggered = 0;
                
                if (automations) {
                    automations.forEach(auto => {
                        if (auto.stats && auto.stats.triggered) {
                            totalTriggered += auto.stats.triggered;
                        }
                    });
                    todayTriggered = Math.floor(totalTriggered * 0.1); // Mock today's data
                }

                document.getElementById('totalContacts').textContent = contacts?.length || 0;
                document.getElementById('totalAutomations').textContent = automations?.length || 0;
                document.getElementById('messagesSent').textContent = totalTriggered || 0;
                document.getElementById('todayTriggers').textContent = todayTriggered;

                // Load settings
                document.getElementById('settingsName').value = currentUser.name;
                document.getElementById('settingsEmail').value = currentUser.email;
                document.getElementById('instaStatus').textContent = currentUser.instagram_connected ? 
                    '✓ Connected as @' + currentUser.instagram_username : 'Not connected';

                // Load billing
                const planBadge = document.getElementById('currentPlan');
                planBadge.textContent = currentUser.plan_type.charAt(0).toUpperCase() + currentUser.plan_type.slice(1);
                planBadge.className = 'badge badge-' + currentUser.plan_type;
                
                if (currentUser.plan_expiry) {
                    const expiry = new Date(currentUser.plan_expiry);
                    document.getElementById('planExpiry').textContent = expiry.toLocaleDateString('en-IN');
                }

                // Load payment history
                await loadPaymentHistory();

                // Load automations
                await loadAutomations();

                // Load contacts
                await loadContacts();

                // Load admin data if admin
                if (currentUser.is_admin) {
                    await loadAdminData();
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showToast('Error loading dashboard data', 'error');
            }
        }

        // ============================================
        // Automations Functions
        // ============================================
        async function loadAutomations() {
            try {
                const { data, error } = await supabase
                    .from('automations')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('automationsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center">No automations yet</td></tr>';
                    return;
                }

                tbody.innerHTML = data.map(auto => `
                    <tr>
                        <td>${auto.name}</td>
                        <td><span class="badge badge-pro">${auto.trigger_type.replace('_', ' ')}</span></td>
                        <td>
                            <label class="toggle">
                                <input type="checkbox" ${auto.is_active ? 'checked' : ''} 
                                    onchange="toggleAutomation('${auto.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </td>
                        <td>Triggered: ${auto.stats?.triggered || 0}, Replied: ${auto.stats?.replied || 0}</td>
                        <td class="action-btns">
                            <button class="btn btn-sm btn-danger" onclick="deleteAutomation('${auto.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading automations:', error);
            }
        }

        async function createAutomation(event) {
            event.preventDefault();
            
            try {
                showLoading();

                // Check limit
                const { count } = await supabase
                    .from('automations')
                    .select('id', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id);

                if (userPlanLimits.automations !== -1 && count >= userPlanLimits.automations) {
                    hideLoading();
                    showToast('Automation limit reached! Upgrade your plan.', 'warning');
                    return;
                }

                const name = document.getElementById('automationName').value;
                const triggerType = document.getElementById('triggerType').value;
                const keywords = document.getElementById('triggerKeywords').value.split(',').map(k => k.trim());
                const response = document.getElementById('responseMessage').value;

                const { error } = await supabase
                    .from('automations')
                    .insert({
                        user_id: currentUser.id,
                        name: name,
                        trigger_type: triggerType,
                        trigger_keywords: keywords,
                        response_message: response,
                        is_active: true,
                        stats: { triggered: 0, replied: 0 },
                        created_at: new Date().toISOString()
                    });

                if (error) throw error;

                hideModal('createAutomationModal');
                document.getElementById('automationName').value = '';
                document.getElementById('triggerKeywords').value = '';
                document.getElementById('responseMessage').value = '';
                
                await loadAutomations();
                await loadDashboard();
                
                hideLoading();
                showToast('Automation created successfully!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error creating automation: ' + error.message, 'error');
            }
        }

        async function toggleAutomation(id, isActive) {
            try {
                const { error } = await supabase
                    .from('automations')
                    .update({ is_active: isActive })
                    .eq('id', id);

                if (error) throw error;

                showToast('Automation ' + (isActive ? 'activated' : 'deactivated'), 'success');
            } catch (error) {
                showToast('Error updating automation', 'error');
            }
        }

        async function deleteAutomation(id) {
            if (!confirm('Are you sure you want to delete this automation?')) return;

            try {
                showLoading();
                
                const { error } = await supabase
                    .from('automations')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                await loadAutomations();
                await loadDashboard();
                
                hideLoading();
                showToast('Automation deleted successfully', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error deleting automation', 'error');
            }
        }

        // ============================================
        // Contacts Functions
        // ============================================
        async function loadContacts() {
            try {
                const { data, error } = await supabase
                    .from('contacts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('contactsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center">No contacts yet</td></tr>';
                    return;
                }

                tbody.innerHTML = data.map(contact => `
                    <tr>
                        <td>@${contact.username}</td>
                        <td>${contact.tags ? contact.tags.map(t => `<span class="badge badge-pro">${t}</span>`).join(' ') : '-'}</td>
                        <td>${contact.last_message_at ? new Date(contact.last_message_at).toLocaleString('en-IN') : 'Never'}</td>
                        <td class="action-btns">
                            <button class="btn btn-sm btn-danger" onclick="deleteContact('${contact.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }

        async function addContact(event) {
            event.preventDefault();
            
            try {
                showLoading();

                // Check limit
                const { count } = await supabase
                    .from('contacts')
                    .select('id', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id);

                if (userPlanLimits.contacts !== -1 && count >= userPlanLimits.contacts) {
                    hideLoading();
                    showToast('Contacts limit reached! Upgrade your plan.', 'warning');
                    return;
                }

                const username = document.getElementById('contactUsername').value;
                const tags = document.getElementById('contactTags').value.split(',').map(t => t.trim()).filter(t => t);

                const { error } = await supabase
                    .from('contacts')
                    .insert({
                        user_id: currentUser.id,
                        username: username,
                        instagram_id: 'ig_' + Math.random().toString(36).substr(2, 9),
                        profile_pic: 'https://ui-avatars.com/api/?name=' + username,
                        tags: tags.length > 0 ? tags : null,
                        created_at: new Date().toISOString()
                    });

                if (error) throw error;

                hideModal('addContactModal');
                document.getElementById('contactUsername').value = '';
                document.getElementById('contactTags').value = '';
                
                await loadContacts();
                await loadDashboard();
                
                hideLoading();
                showToast('Contact added successfully!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error adding contact: ' + error.message, 'error');
            }
        }

        async function deleteContact(id) {
            if (!confirm('Are you sure you want to delete this contact?')) return;

            try {
                showLoading();
                
                const { error } = await supabase
                    .from('contacts')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                await loadContacts();
                await loadDashboard();
                
                hideLoading();
                showToast('Contact deleted successfully', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error deleting contact', 'error');
            }
        }

        // ============================================
        // Payment Functions
        // ============================================
        async function loadPaymentHistory() {
            try {
                const { data, error } = await supabase
                    .from('subscriptions')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) throw error;

                const tbody = document.getElementById('paymentHistory');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center">No payment history</td></tr>';
                    return;
                }

                tbody.innerHTML = data.map(payment => `
                    <tr>
                        <td>${new Date(payment.created_at).toLocaleDateString('en-IN')}</td>
                        <td><span class="badge badge-${payment.plan_type}">${payment.plan_type}</span></td>
                        <td>₹${payment.amount}</td>
                        <td><span class="badge ${payment.payment_status === 'success' ? 'badge-active' : 'badge-inactive'}">${payment.payment_status}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading payment history:', error);
            }
        }

        function upgradePlan(planType, amount) {
            const transactionId = 'TXN' + Date.now();
            const upiUrl = `upi://pay?pa=${UPI_ID}&pn=InstaBot Pro&am=${amount}&tn=Subscription ${planType}&tr=${transactionId}`;
            
            // Check if mobile device
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = upiUrl;
            } else {
                alert(`Please scan QR code or use UPI ID: ${UPI_ID}\nAmount: ₹${amount}\nTransaction ID: ${transactionId}\n\nAfter payment, contact support with transaction ID for verification.`);
            }
            
            // Create pending subscription
            createPendingSubscription(planType, amount, transactionId);
        }

        async function createPendingSubscription(planType, amount, transactionId) {
            try {
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + 1);
                
                const { error } = await supabase
                    .from('subscriptions')
                    .insert({
                        user_id: currentUser.id,
                        plan_type: planType,
                        amount: amount,
                        transaction_id: transactionId,
                        payment_status: 'pending',
                        payment_method: 'phonepe',
                        created_at: new Date().toISOString(),
                        expires_at: expiryDate.toISOString()
                    });

                if (error) throw error;

                showToast('Payment initiated. Please complete the payment.', 'warning');
                
                // In real scenario, you would verify payment via PhonePe webhook
                // For demo, we'll just show the payment in history
                await loadPaymentHistory();
            } catch (error) {
                showToast('Error creating subscription: ' + error.message, 'error');
            }
        }

        // ============================================
        // Admin Functions
        // ============================================
        async function loadAdminData() {
            try {
                // Load total users
                const { data: users, error: usersError } = await supabase
                    .from('users')
                    .select('*');

                if (usersError) throw usersError;

                document.getElementById('adminTotalUsers').textContent = users.length;

                // Calculate revenue
                const { data: subscriptions } = await supabase
                    .from('subscriptions')
                    .select('amount')
                    .eq('payment_status', 'success');

                const totalRevenue = subscriptions?.reduce((sum, sub) => sum + sub.amount, 0) || 0;
                document.getElementById('adminRevenue').textContent = '₹' + totalRevenue;

                // Count pro users
                const proUsers = users.filter(u => u.plan_type !== 'free').length;
                document.getElementById('adminProUsers').textContent = proUsers;

                // Load users table
                const tbody = document.getElementById('adminUsersTable');
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td><span class="badge badge-${user.plan_type}">${user.plan_type}</span></td>
                        <td>${new Date(user.created_at).toLocaleDateString('en-IN')}</td>
                        <td class="action-btns">
                            <button class="btn btn-sm btn-warning" onclick="openChangePlanModal('${user.id}', '${user.name}')">
                                <i class="fas fa-edit"></i> Change Plan
                            </button>
                        </td>
                    </tr>
                `).join('');

                // Load plan data for edit modal
                const { data: plans } = await supabase
                    .from('plans')
                    .select('*');

                if (plans) {
                    plans.forEach(plan => {
                        if (plan.name === 'free') {
                            document.getElementById('freeLimitContacts').value = plan.contacts_limit;
                            document.getElementById('freeLimitAuto').value = plan.automations_limit;
                        } else if (plan.name === 'pro') {
                            document.getElementById('proPrice').value = plan.price;
                            document.getElementById('proLimitContacts').value = plan.contacts_limit;
                            document.getElementById('proLimitAuto').value = plan.automations_limit;
                        } else if (plan.name === 'master') {
                            document.getElementById('masterPrice').value = plan.price;
                            document.getElementById('masterLimitContacts').value = plan.contacts_limit;
                            document.getElementById('masterLimitAuto').value = plan.automations_limit;
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
                showToast('Error loading admin data', 'error');
            }
        }

        async function updatePlans(event) {
            event.preventDefault();
            
            try {
                showLoading();

                // Update Free plan
                await supabase
                    .from('plans')
                    .update({
                        contacts_limit: parseInt(document.getElementById('freeLimitContacts').value),
                        automations_limit: parseInt(document.getElementById('freeLimitAuto').value)
                    })
                    .eq('name', 'free');

                // Update Pro plan
                await supabase
                    .from('plans')
                    .update({
                        price: parseInt(document.getElementById('proPrice').value),
                        contacts_limit: parseInt(document.getElementById('proLimitContacts').value),
                        automations_limit: parseInt(document.getElementById('proLimitAuto').value)
                    })
                    .eq('name', 'pro');

                // Update Master plan
                await supabase
                    .from('plans')
                    .update({
                        price: parseInt(document.getElementById('masterPrice').value),
                        contacts_limit: parseInt(document.getElementById('masterLimitContacts').value),
                        automations_limit: parseInt(document.getElementById('masterLimitAuto').value)
                    })
                    .eq('name', 'master');

                hideModal('editPlanModal');
                hideLoading();
                showToast('Plans updated successfully!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error updating plans: ' + error.message, 'error');
            }
        }

        function openChangePlanModal(userId, userName) {
            document.getElementById('changeUserId').value = userId;
            document.getElementById('changeUserName').textContent = userName;
            showModal('changeUserPlanModal');
        }

        async function changeUserPlan(event) {
            event.preventDefault();
            
            try {
                showLoading();

                const userId = document.getElementById('changeUserId').value;
                const newPlan = document.getElementById('newPlanType').value;
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + 1);

                const { error } = await supabase
                    .from('users')
                    .update({
                        plan_type: newPlan,
                        plan_expiry: expiryDate.toISOString()
                    })
                    .eq('id', userId);

                if (error) throw error;

                hideModal('changeUserPlanModal');
                await loadAdminData();
                hideLoading();
                showToast('User plan changed successfully!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error changing user plan: ' + error.message, 'error');
            }
        }

        // ============================================
        // UI Helper Functions
        // ============================================
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Add active to clicked nav item
            event.target.closest('.nav-item').classList.add('active');

            // Close mobile menu
            document.getElementById('sidebar').classList.remove('open');
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = 'toast ' + type;
            toastMessage.textContent = message;
            toast.style.display = 'flex';

            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Mobile menu toggle
        const mobileMenuBtn = document.createElement('button');
        mobileMenuBtn.className = 'mobile-menu-btn';
        mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
        mobileMenuBtn.onclick = () => {
            document.getElementById('sidebar').classList.toggle('open');
        };
        document.body.appendChild(mobileMenuBtn);

        // ============================================
        // Initialize on page load
        // ============================================
        window.addEventListener('load', async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                await handleUserLogin(session.user);
            }
        });

        // ============================================
        // DATABASE SETUP INSTRUCTIONS
        // ============================================
        /*
        
        SUPABASE DATABASE SETUP:
        
        1. Create tables with the following SQL:

        -- Users table
        CREATE TABLE users (
            id UUID PRIMARY KEY REFERENCES auth.users(id),
            email TEXT UNIQUE NOT NULL,
            name TEXT,
            avatar_url TEXT,
            google_id TEXT,
            instagram_connected BOOLEAN DEFAULT false,
            instagram_token TEXT,
            instagram_username TEXT,
            plan_type TEXT DEFAULT 'free',
            plan_expiry TIMESTAMP,
            contacts_count INTEGER DEFAULT 0,
            automations_count INTEGER DEFAULT 0,
            is_admin BOOLEAN DEFAULT false,
            created_at TIMESTAMP DEFAULT NOW(),
            updated_at TIMESTAMP DEFAULT NOW()
        );

        -- Contacts table
        CREATE TABLE contacts (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            instagram_id TEXT,
            username TEXT NOT NULL,
            profile_pic TEXT,
            tags TEXT[],
            last_message_at TIMESTAMP,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Automations table
        CREATE TABLE automations (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            name TEXT NOT NULL,
            trigger_type TEXT NOT NULL,
            trigger_keywords TEXT[],
            response_message TEXT NOT NULL,
            is_active BOOLEAN DEFAULT true,
            stats JSONB DEFAULT '{"triggered": 0, "replied": 0}'::jsonb,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Messages table
        CREATE TABLE messages (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            contact_id UUID REFERENCES contacts(id) ON DELETE CASCADE,
            content TEXT NOT NULL,
            sender_type TEXT NOT NULL,
            is_automated BOOLEAN DEFAULT false,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Subscriptions table
        CREATE TABLE subscriptions (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            plan_type TEXT NOT NULL,
            amount INTEGER NOT NULL,
            transaction_id TEXT,
            payment_status TEXT DEFAULT 'pending',
            payment_method TEXT DEFAULT 'phonepe',
            created_at TIMESTAMP DEFAULT NOW(),
            expires_at TIMESTAMP
        );

        -- Plans table
        CREATE TABLE plans (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            name TEXT UNIQUE NOT NULL,
            price INTEGER NOT NULL,
            contacts_limit INTEGER NOT NULL,
            automations_limit INTEGER NOT NULL,
            team_members_limit INTEGER NOT NULL,
            features JSONB,
            is_active BOOLEAN DEFAULT true
        );

        -- Insert default plans
        INSERT INTO plans (name, price, contacts_limit, automations_limit, team_members_limit, is_active) VALUES
        ('free', 0, 1000, 3, 1, true),
        ('pro', 199, 10000, 25, 5, true),
        ('master', 499, -1, -1, -1, true);

        2. Set up Row Level Security (RLS):

        -- Enable RLS on all tables
        ALTER TABLE users ENABLE ROW LEVEL SECURITY;
        ALTER TABLE contacts ENABLE ROW LEVEL SECURITY;
        ALTER TABLE automations ENABLE ROW LEVEL SECURITY;
        ALTER TABLE messages ENABLE ROW LEVEL SECURITY;
        ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
        ALTER TABLE plans ENABLE ROW LEVEL SECURITY;

        -- Users policies
        CREATE POLICY "Users can view own data" ON users
            FOR SELECT USING (auth.uid() = id);
        
        CREATE POLICY "Users can update own data" ON users
            FOR UPDATE USING (auth.uid() = id);

        CREATE POLICY "Admins can view all users" ON users
            FOR SELECT USING (
                EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true)
            );

        CREATE POLICY "Admins can update all users" ON users
            FOR UPDATE USING (
                EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true)
            );

        -- Contacts policies
        CREATE POLICY "Users can manage own contacts" ON contacts
            FOR ALL USING (auth.uid() = user_id);

        -- Automations policies
        CREATE POLICY "Users can manage own automations" ON automations
            FOR ALL USING (auth.uid() = user_id);

        -- Messages policies
        CREATE POLICY "Users can manage own messages" ON messages
            FOR ALL USING (auth.uid() = user_id);

        -- Subscriptions policies
        CREATE POLICY "Users can view own subscriptions" ON subscriptions
            FOR SELECT USING (auth.uid() = user_id);

        CREATE POLICY "Users can insert own subscriptions" ON subscriptions
            FOR INSERT WITH CHECK (auth.uid() = user_id);

        CREATE POLICY "Admins can view all subscriptions" ON subscriptions
            FOR SELECT USING (
                EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true)
            );

        -- Plans policies (everyone can read, only admins can modify)
        CREATE POLICY "Anyone can view plans" ON plans
            FOR SELECT USING (true);

        CREATE POLICY "Admins can update plans" ON plans
            FOR UPDATE USING (
                EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true)
            );

        3. Enable Google OAuth:
        - Go to Authentication > Providers
        - Enable Google provider
        - Add your Google Client ID and Secret
        - Add authorized redirect URL: https://your-project.supabase.co/auth/v1/callback

        4. To make a user admin:
        UPDATE users SET is_admin = true WHERE email = 'your-admin-email@example.com';

        5. Update CONFIGURATION section in the code with your:
        - SUPABASE_URL
        - SUPABASE_ANON_KEY
        - UPI_ID (for PhonePe payments)

        */

        console.log('%c🚀 InstaBot Pro Loaded Successfully!', 'color: #6366f1; font-size: 20px; font-weight: bold;');
        console.log('%cSee database setup instructions in source code', 'color: #94a3b8; font-size: 14px;');
    </script>
</body>
</html>
