<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaBot Pro - Instagram Automation Platform</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--darker);
            color: var(--light);
            overflow-x: hidden;
            min-height: 100vh;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float 20s infinite ease-in-out;
            z-index: 1;
            pointer-events: none;
        }

        .orb1 {
            width: 400px;
            height: 400px;
            background: var(--primary);
            top: -200px;
            left: -200px;
        }

        .orb2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -250px;
            right: -250px;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 50px) scale(1.1); }
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--glass);
            color: var(--light);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Landing Page */
        .landing-page {
            position: relative;
            z-index: 2;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero {
            text-align: center;
            padding: 100px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 20px;
            color: #94a3b8;
            margin-bottom: 40px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 80px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            text-align: center;
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pricing {
            padding: 80px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .pricing h2 {
            text-align: center;
            font-size: 42px;
            margin-bottom: 50px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .pricing-card {
            text-align: center;
        }

        .pricing-card.popular {
            border: 2px solid var(--primary);
        }

        .price {
            font-size: 48px;
            font-weight: 700;
            margin: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .feature-list {
            list-style: none;
            margin: 30px 0;
            text-align: left;
        }

        .feature-list li {
            padding: 10px 0;
            color: #94a3b8;
        }

        .feature-list i {
            color: var(--primary);
            margin-right: 10px;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            position: relative;
            z-index: 2;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--glass-border);
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            margin-bottom: 30px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-details {
            flex: 1;
            overflow: hidden;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 11px;
            color: #94a3b8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }

        .nav-item:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h1 {
            font-size: 28px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            font-size: 24px;
        }

        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-info p {
            color: #94a3b8;
            font-size: 13px;
        }

        .table-container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
        }

        th {
            background: rgba(99, 102, 241, 0.1);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 20px;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
            color: #94a3b8;
            line-height: 1;
        }

        .close:hover {
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: var(--glass);
            color: var(--light);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* Toggle */
        .toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: 0.3s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-free { background: #334155; color: #94a3b8; }
        .badge-pro { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .badge-master { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
        .badge-active, .badge-success { background: #10b981; color: white; }
        .badge-inactive, .badge-failed { background: #ef4444; color: white; }
        .badge-pending { background: #f59e0b; color: white; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 12px;
            background: var(--dark);
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            max-width: 400px;
            animation: slideUp 0.3s ease;
        }

        .toast.show { display: flex; }
        .toast.success { border-left: 4px solid #10b981; }
        .toast.error { border-left: 4px solid #ef4444; }
        .toast.warning { border-left: 4px solid #f59e0b; }
        .toast.info { border-left: 4px solid #3b82f6; }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(2, 6, 23, 0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading.show { display: flex; }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--glass-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #94a3b8;
            font-size: 14px;
        }

        .section { display: none; }
        .section.active { display: block; }

        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }

        .action-btns { display: flex; gap: 8px; }
        .btn-sm { padding: 8px 12px; font-size: 12px; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-success { background: #10b981; color: white; }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--light);
        }

        /* Status Banner */
        .status-banner {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 14px;
            position: relative;
            z-index: 10;
        }

        .status-banner.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .status-banner.info {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .hero h1 { font-size: 32px; }
            .hero p { font-size: 16px; }
            .features, .pricing { padding: 40px 20px; }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 280px;
            }

            .sidebar.open { transform: translateX(0); }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .stats-grid { grid-template-columns: 1fr; }

            .mobile-menu-btn { display: flex !important; }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }

            table { font-size: 12px; }
            th, td { padding: 10px; }
        }

        .mobile-menu-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            z-index: 99;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 98;
        }

        .overlay.show { display: block; }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>

    <!-- Status Banner -->
    <div class="status-banner" id="statusBanner" style="display: none;">
        <i class="fas fa-info-circle"></i> <span id="statusText"></span>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle" id="toastIcon"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Loading...</div>
    </div>

    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <nav class="navbar">
            <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
            <button class="btn btn-primary" onclick="loginWithGoogle()">
                <i class="fab fa-google"></i> Login with Google
            </button>
        </nav>

        <section class="hero animate__animated animate__fadeIn">
            <h1>Automate Your Instagram DMs</h1>
            <p>The most powerful Instagram automation platform for businesses</p>
            <button class="btn btn-primary" onclick="loginWithGoogle()" style="font-size: 16px; padding: 16px 32px;">
                <i class="fab fa-google"></i> Get Started with Google
            </button>
        </section>

        <section class="features">
            <div class="glass-card feature-card animate__animated animate__fadeInUp">
                <div class="feature-icon"><i class="fas fa-robot"></i></div>
                <h3>Smart Automation</h3>
                <p>Auto-reply to DMs, comments, and story mentions with intelligent triggers</p>
            </div>
            <div class="glass-card feature-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                <div class="feature-icon"><i class="fas fa-users"></i></div>
                <h3>Contact Management</h3>
                <p>Organize unlimited contacts with tags and advanced filtering</p>
            </div>
            <div class="glass-card feature-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Analytics Dashboard</h3>
                <p>Track engagement, response rates, and automation performance</p>
            </div>
        </section>

        <section class="pricing">
            <h2>Choose Your Plan</h2>
            <div class="pricing-grid">
                <div class="glass-card pricing-card">
                    <h3>Free</h3>
                    <div class="price">â‚¹0<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 1,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 3 Automations</li>
                        <li><i class="fas fa-check"></i> 1 Team Member</li>
                        <li><i class="fas fa-check"></i> Basic Analytics</li>
                    </ul>
                    <button class="btn btn-secondary" onclick="loginWithGoogle()" style="width: 100%;">Get Started</button>
                </div>

                <div class="glass-card pricing-card popular">
                    <h3>Pro</h3>
                    <div class="price">â‚¹199<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 25 Automations</li>
                        <li><i class="fas fa-check"></i> 5 Team Members</li>
                        <li><i class="fas fa-check"></i> Advanced Analytics</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()" style="width: 100%;">Start Pro</button>
                </div>

                <div class="glass-card pricing-card">
                    <h3>Master</h3>
                    <div class="price">â‚¹499<span style="font-size: 18px;">/month</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Unlimited Contacts</li>
                        <li><i class="fas fa-check"></i> Unlimited Automations</li>
                        <li><i class="fas fa-check"></i> Unlimited Team</li>
                        <li><i class="fas fa-check"></i> Premium Analytics</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()" style="width: 100%;">Start Master</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
            </div>
            
            <div class="user-info" id="userInfo">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-email" id="userEmail">user@email.com</div>
                </div>
            </div>

            <nav id="sidebarNav">
                <div class="nav-item active" data-section="dashboardSection">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" data-section="automationsSection">
                    <i class="fas fa-robot"></i> Automations
                </div>
                <div class="nav-item" data-section="contactsSection">
                    <i class="fas fa-users"></i> Contacts
                </div>
                <div class="nav-item" data-section="inboxSection">
                    <i class="fas fa-inbox"></i> Inbox
                </div>
                <div class="nav-item" data-section="analyticsSection">
                    <i class="fas fa-chart-bar"></i> Analytics
                </div>
                <div class="nav-item" data-section="billingSection">
                    <i class="fas fa-credit-card"></i> Billing
                </div>
                <div class="nav-item" data-section="settingsSection">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-item hidden" id="adminNav" data-section="adminSection">
                    <i class="fas fa-crown"></i> Admin Panel
                </div>
                <div class="nav-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Dashboard Section -->
            <div class="section active" id="dashboardSection">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <span class="badge" id="planBadge">Free</span>
                </div>
                
                <div class="stats-grid">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="statContacts">0</h3>
                            <p>Total Contacts</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-robot"></i></div>
                        <div class="stat-info">
                            <h3 id="statAutomations">0</h3>
                            <p>Automations</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-paper-plane"></i></div>
                        <div class="stat-info">
                            <h3 id="statMessages">0</h3>
                            <p>Messages Sent</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                        <div class="stat-info">
                            <h3 id="statTriggers">0</h3>
                            <p>Today's Triggers</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <h2 style="margin-bottom: 20px;">Quick Actions</h2>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showModal('automationModal')">
                            <i class="fas fa-plus"></i> Create Automation
                        </button>
                        <button class="btn btn-primary" onclick="showModal('contactModal')">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </button>
                        <button class="btn btn-secondary" onclick="navigateTo('billingSection')">
                            <i class="fas fa-crown"></i> Upgrade Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Automations Section -->
            <div class="section" id="automationsSection">
                <div class="page-header">
                    <h1>Automations</h1>
                    <button class="btn btn-primary" onclick="showModal('automationModal')">
                        <i class="fas fa-plus"></i> Create Automation
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Trigger</th>
                                <th>Status</th>
                                <th>Stats</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="automationsTable">
                            <tr><td colspan="5" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contacts Section -->
            <div class="section" id="contactsSection">
                <div class="page-header">
                    <h1>Contacts</h1>
                    <button class="btn btn-primary" onclick="showModal('contactModal')">
                        <i class="fas fa-user-plus"></i> Add Contact
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Tags</th>
                                <th>Last Message</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTable">
                            <tr><td colspan="4" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inbox Section -->
            <div class="section" id="inboxSection">
                <div class="page-header">
                    <h1>Inbox</h1>
                </div>
                <div class="glass-card">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Connect Instagram</h3>
                        <p>Connect your Instagram account to view and manage messages</p>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="section" id="analyticsSection">
                <div class="page-header">
                    <h1>Analytics</h1>
                </div>
                <div class="stats-grid">
                    <div class="glass-card">
                        <h3 style="margin-bottom: 15px;">Messages This Week</h3>
                        <div style="font-size: 42px; font-weight: bold; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            <span id="analyticsWeekly">0</span>
                        </div>
                    </div>
                    <div class="glass-card">
                        <h3 style="margin-bottom: 15px;">Response Rate</h3>
                        <div style="font-size: 42px; font-weight: bold; color: #10b981;">
                            <span id="analyticsRate">0</span>%
                        </div>
                    </div>
                    <div class="glass-card">
                        <h3 style="margin-bottom: 15px;">Avg Response Time</h3>
                        <div style="font-size: 42px; font-weight: bold; color: #f59e0b;">
                            <span id="analyticsTime">0</span>s
                        </div>
                    </div>
                </div>
            </div>

            <!-- Billing Section -->
            <div class="section" id="billingSection">
                <div class="page-header">
                    <h1>Billing</h1>
                </div>
                
                <div class="glass-card mb-30">
                    <h2>Current Plan: <span id="currentPlan" class="badge badge-free">Free</span></h2>
                    <p style="color: #94a3b8; margin-top: 10px;">Expires: <span id="planExpiry">Never</span></p>
                </div>

                <div class="pricing-grid mb-30">
                    <div class="glass-card pricing-card">
                        <h3>Pro Plan</h3>
                        <div class="price">â‚¹199<span style="font-size: 18px;">/month</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                            <li><i class="fas fa-check"></i> 25 Automations</li>
                            <li><i class="fas fa-check"></i> 5 Team Members</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('pro', 199)" style="width: 100%;">Upgrade to Pro</button>
                    </div>

                    <div class="glass-card pricing-card">
                        <h3>Master Plan</h3>
                        <div class="price">â‚¹499<span style="font-size: 18px;">/month</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Unlimited Contacts</li>
                            <li><i class="fas fa-check"></i> Unlimited Automations</li>
                            <li><i class="fas fa-check"></i> Unlimited Team</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('master', 499)" style="width: 100%;">Upgrade to Master</button>
                    </div>
                </div>

                <div class="glass-card">
                    <h2 style="margin-bottom: 20px;">Payment History</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Plan</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistory">
                                <tr><td colspan="4" class="text-center">No payments yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settingsSection">
                <div class="page-header">
                    <h1>Settings</h1>
                </div>
                <div class="glass-card">
                    <h2 style="margin-bottom: 20px;">Profile Information</h2>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" class="form-control" id="settingsName" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="settingsEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label>Instagram Status</label>
                        <p id="instaStatus" style="color: #94a3b8; padding: 12px 0;">Not connected</p>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div class="section" id="adminSection">
                <div class="page-header">
                    <h1>Admin Panel</h1>
                </div>
                <div class="stats-grid mb-30">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="adminUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-rupee-sign"></i></div>
                        <div class="stat-info">
                            <h3 id="adminRevenue">â‚¹0</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-crown"></i></div>
                        <div class="stat-info">
                            <h3 id="adminPro">0</h3>
                            <p>Pro Users</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <h2 style="margin-bottom: 20px;">All Users</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Plan</th>
                                    <th>Joined</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <tr><td colspan="4" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars" id="mobileMenuIcon"></i>
    </button>

    <!-- Create Automation Modal -->
    <div class="modal" id="automationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Automation</h2>
                <span class="close" onclick="hideModal('automationModal')">&times;</span>
            </div>
            <form id="automationForm">
                <div class="form-group">
                    <label>Automation Name *</label>
                    <input type="text" class="form-control" id="autoName" placeholder="Welcome Message" required>
                </div>
                <div class="form-group">
                    <label>Trigger Type *</label>
                    <select class="form-control" id="autoTrigger" required>
                        <option value="keyword_dm">Keyword in DM</option>
                        <option value="keyword_comment">Keyword in Comment</option>
                        <option value="story_mention">Story Mention</option>
                        <option value="first_message">First Message</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Trigger Keywords * (comma separated)</label>
                    <input type="text" class="form-control" id="autoKeywords" placeholder="hi, hello, price" required>
                </div>
                <div class="form-group">
                    <label>Response Message *</label>
                    <textarea class="form-control" id="autoResponse" placeholder="Thanks for reaching out!" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Automation
                </button>
            </form>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Contact</h2>
                <span class="close" onclick="hideModal('contactModal')">&times;</span>
            </div>
            <form id="contactForm">
                <div class="form-group">
                    <label>Instagram Username *</label>
                    <input type="text" class="form-control" id="contactUsername" placeholder="username" required>
                </div>
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" class="form-control" id="contactTags" placeholder="customer, vip">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Add Contact
                </button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            SUPABASE_URL: 'https://uvnksakgjupnivmfkjcv.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2bmtzYWtnanVwbml2bWZramN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzM5NzYsImV4cCI6MjA4MTQ0OTk3Nn0.gM5hYGxnUI-n_zM-iut8Dml1T5593YhH5A9HNo8hovA',
            UPI_ID: 'your-upi@ybl'
        };

        // ============================================
        // STATE
        // ============================================
        let supabase = null;
        let currentUser = null;
        let planLimits = { contacts: 1000, automations: 3 };

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', init);

        async function init() {
            console.log('ðŸš€ Initializing InstaBot Pro...');
            
            try {
                // 1. Initialize particles (non-blocking)
                initParticles();
                
                // 2. Initialize Supabase
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase library not loaded');
                }
                
                supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
                console.log('âœ… Supabase connected');
                
                // 3. Setup event listeners
                setupEventListeners();
                
                // 4. Check for existing session
                await checkSession();
                
                console.log('âœ… InstaBot Pro Ready!');
                
            } catch (error) {
                console.error('âŒ Init error:', error);
                hideLoading();
                showStatus('Error: ' + error.message, 'error');
            }
        }

        function initParticles() {
            if (typeof particlesJS === 'function') {
                particlesJS('particles-js', {
                    particles: {
                        number: { value: 60 },
                        color: { value: '#6366f1' },
                        shape: { type: 'circle' },
                        opacity: { value: 0.4 },
                        size: { value: 3 },
                        line_linked: { enable: true, distance: 150, color: '#6366f1', opacity: 0.3, width: 1 },
                        move: { enable: true, speed: 2 }
                    }
                });
            }
        }

        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.dataset.section;
                    navigateTo(section);
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Mobile menu
            const mobileBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            mobileBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('show');
                const icon = document.getElementById('mobileMenuIcon');
                icon.className = sidebar.classList.contains('open') ? 'fas fa-times' : 'fas fa-bars';
            });
            
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
                document.getElementById('mobileMenuIcon').className = 'fas fa-bars';
            });
            
            // Forms
            document.getElementById('automationForm').addEventListener('submit', createAutomation);
            document.getElementById('contactForm').addEventListener('submit', createContact);
            
            // Modal close on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.remove('show');
                });
            });
            
            // Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.show').forEach(m => m.classList.remove('show'));
                }
            });
        }

        async function checkSession() {
            showLoading('Checking session...');
            
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) throw error;
                
                if (session) {
                    console.log('ðŸ“Œ Session found');
                    await handleUserSession(session.user);
                } else {
                    console.log('ðŸ“Œ No session');
                    hideLoading();
                }
                
                // Listen for auth changes
                supabase.auth.onAuthStateChange(async (event, session) => {
                    console.log('ðŸ”„ Auth event:', event);
                    if (event === 'SIGNED_IN' && session) {
                        await handleUserSession(session.user);
                    } else if (event === 'SIGNED_OUT') {
                        showLandingPage();
                    }
                });
                
            } catch (error) {
                console.error('Session check error:', error);
                hideLoading();
            }
        }

        // ============================================
        // AUTH FUNCTIONS
        // ============================================
        async function loginWithGoogle() {
            if (!supabase) {
                showToast('Database not connected. Please refresh.', 'error');
                return;
            }
            
            showLoading('Connecting to Google...');
            
            try {
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + window.location.pathname
                    }
                });
                
                if (error) throw error;
                
                // OAuth will redirect
            } catch (error) {
                hideLoading();
                console.error('Login error:', error);
                showToast('Login failed: ' + error.message, 'error');
            }
        }

        async function handleUserSession(authUser) {
            showLoading('Loading your account...');
            
            try {
                // Get or create user in database
                let { data: dbUser, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', authUser.id)
                    .single();
                
                if (error && error.code === 'PGRST116') {
                    // User doesn't exist, create one
                    console.log('Creating new user...');
                    
                    const newUser = {
                        id: authUser.id,
                        email: authUser.email,
                        name: authUser.user_metadata?.full_name || authUser.email?.split('@')[0] || 'User',
                        avatar_url: authUser.user_metadata?.avatar_url,
                        plan_type: 'free',
                        plan_expiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString()
                    };
                    
                    const { data: createdUser, error: createError } = await supabase
                        .from('users')
                        .insert(newUser)
                        .select()
                        .single();
                    
                    if (createError) throw createError;
                    dbUser = createdUser;
                    
                } else if (error) {
                    throw error;
                }
                
                currentUser = dbUser;
                console.log('âœ… User loaded:', currentUser.name);
                
                // Load plan limits
                await loadPlanLimits();
                
                // Show dashboard
                showDashboard();
                
                // Load all data
                await loadAllData();
                
                hideLoading();
                showToast(`Welcome, ${currentUser.name}!`, 'success');
                
            } catch (error) {
                console.error('Handle session error:', error);
                hideLoading();
                showToast('Error loading account: ' + error.message, 'error');
                showStatus('Database error. Make sure tables are created.', 'error');
            }
        }

        async function logout() {
            showLoading('Logging out...');
            
            try {
                await supabase.auth.signOut();
                currentUser = null;
                showLandingPage();
                hideLoading();
                showToast('Logged out successfully', 'success');
            } catch (error) {
                hideLoading();
                showToast('Logout error: ' + error.message, 'error');
            }
        }

        // ============================================
        // DATA FUNCTIONS
        // ============================================
        async function loadPlanLimits() {
            try {
                const { data } = await supabase
                    .from('plans')
                    .select('*')
                    .eq('name', currentUser.plan_type)
                    .single();
                
                if (data) {
                    planLimits = {
                        contacts: data.contacts_limit,
                        automations: data.automations_limit
                    };
                }
            } catch (e) {
                console.error('Plan limits error:', e);
            }
        }

        async function loadAllData() {
            await Promise.all([
                loadDashboardStats(),
                loadAutomations(),
                loadContacts(),
                loadPaymentHistory()
            ]);
            
            if (currentUser.is_admin) {
                document.getElementById('adminNav').classList.remove('hidden');
                await loadAdminData();
            }
        }

        async function loadDashboardStats() {
            try {
                const [contactsRes, automationsRes] = await Promise.all([
                    supabase.from('contacts').select('id', { count: 'exact' }).eq('user_id', currentUser.id),
                    supabase.from('automations').select('id, stats').eq('user_id', currentUser.id)
                ]);
                
                const contactCount = contactsRes.count || 0;
                const automations = automationsRes.data || [];
                const autoCount = automations.length;
                
                let totalTriggered = 0;
                automations.forEach(a => {
                    if (a.stats?.triggered) totalTriggered += a.stats.triggered;
                });
                
                document.getElementById('statContacts').textContent = contactCount;
                document.getElementById('statAutomations').textContent = autoCount;
                document.getElementById('statMessages').textContent = totalTriggered;
                document.getElementById('statTriggers').textContent = Math.floor(totalTriggered * 0.15);
                
                // Analytics
                document.getElementById('analyticsWeekly').textContent = Math.floor(totalTriggered * 0.4);
                document.getElementById('analyticsRate').textContent = totalTriggered > 0 ? '94' : '0';
                document.getElementById('analyticsTime').textContent = totalTriggered > 0 ? '2.3' : '0';
                
            } catch (e) {
                console.error('Stats error:', e);
            }
        }

        async function loadAutomations() {
            try {
                const { data, error } = await supabase
                    .from('automations')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const tbody = document.getElementById('automationsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <i class="fas fa-robot"></i>
                                    <h3>No Automations</h3>
                                    <p>Create your first automation to get started</p>
                                </div>
                            </td>
                        </tr>`;
                    return;
                }
                
                tbody.innerHTML = data.map(a => `
                    <tr>
                        <td><strong>${escapeHtml(a.name)}</strong></td>
                        <td><span class="badge badge-pro">${a.trigger_type.replace('_', ' ')}</span></td>
                        <td>
                            <label class="toggle">
                                <input type="checkbox" ${a.is_active ? 'checked' : ''} onchange="toggleAutomation('${a.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </td>
                        <td>Triggered: ${a.stats?.triggered || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteAutomation('${a.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (e) {
                console.error('Automations error:', e);
            }
        }

        async function loadContacts() {
            try {
                const { data, error } = await supabase
                    .from('contacts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const tbody = document.getElementById('contactsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h3>No Contacts</h3>
                                    <p>Add your first contact to get started</p>
                                </div>
                            </td>
                        </tr>`;
                    return;
                }
                
                tbody.innerHTML = data.map(c => `
                    <tr>
                        <td><strong>@${escapeHtml(c.username)}</strong></td>
                        <td>${c.tags?.map(t => `<span class="badge badge-pro">${escapeHtml(t)}</span>`).join(' ') || '-'}</td>
                        <td>${c.last_message_at ? new Date(c.last_message_at).toLocaleDateString() : 'Never'}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteContact('${c.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (e) {
                console.error('Contacts error:', e);
            }
        }

        async function loadPaymentHistory() {
            try {
                const { data } = await supabase
                    .from('subscriptions')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                const tbody = document.getElementById('paymentHistory');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center">No payments yet</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(p => `
                    <tr>
                        <td>${new Date(p.created_at).toLocaleDateString()}</td>
                        <td><span class="badge badge-${p.plan_type}">${p.plan_type}</span></td>
                        <td>â‚¹${p.amount}</td>
                        <td><span class="badge badge-${p.payment_status}">${p.payment_status}</span></td>
                    </tr>
                `).join('');
                
            } catch (e) {
                console.error('Payment history error:', e);
            }
        }

        async function loadAdminData() {
            try {
                const { data: users } = await supabase.from('users').select('*');
                const { data: subs } = await supabase.from('subscriptions').select('amount').eq('payment_status', 'success');
                
                const totalUsers = users?.length || 0;
                const proUsers = users?.filter(u => u.plan_type !== 'free').length || 0;
                const revenue = subs?.reduce((sum, s) => sum + (s.amount || 0), 0) || 0;
                
                document.getElementById('adminUsers').textContent = totalUsers;
                document.getElementById('adminPro').textContent = proUsers;
                document.getElementById('adminRevenue').textContent = 'â‚¹' + revenue;
                
                const tbody = document.getElementById('adminUsersTable');
                if (users && users.length > 0) {
                    tbody.innerHTML = users.map(u => `
                        <tr>
                            <td>${escapeHtml(u.name || 'N/A')}</td>
                            <td>${escapeHtml(u.email)}</td>
                            <td><span class="badge badge-${u.plan_type}">${u.plan_type}</span></td>
                            <td>${new Date(u.created_at).toLocaleDateString()}</td>
                        </tr>
                    `).join('');
                }
                
            } catch (e) {
                console.error('Admin data error:', e);
            }
        }

        // ============================================
        // CRUD OPERATIONS
        // ============================================
        async function createAutomation(e) {
            e.preventDefault();
            
            const name = document.getElementById('autoName').value.trim();
            const trigger = document.getElementById('autoTrigger').value;
            const keywords = document.getElementById('autoKeywords').value.split(',').map(k => k.trim()).filter(k => k);
            const response = document.getElementById('autoResponse').value.trim();
            
            if (!name || !keywords.length || !response) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            showLoading('Creating automation...');
            
            try {
                // Check limit
                const { count } = await supabase
                    .from('automations')
                    .select('id', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id);
                
                if (planLimits.automations !== -1 && count >= planLimits.automations) {
                    hideLoading();
                    showToast('Automation limit reached! Upgrade your plan.', 'warning');
                    return;
                }
                
                const { error } = await supabase.from('automations').insert({
                    user_id: currentUser.id,
                    name,
                    trigger_type: trigger,
                    trigger_keywords: keywords,
                    response_message: response,
                    is_active: true,
                    stats: { triggered: 0, replied: 0 }
                });
                
                if (error) throw error;
                
                document.getElementById('automationForm').reset();
                hideModal('automationModal');
                await loadAutomations();
                await loadDashboardStats();
                hideLoading();
                showToast('Automation created!', 'success');
                
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function toggleAutomation(id, isActive) {
            try {
                await supabase.from('automations').update({ is_active: isActive }).eq('id', id);
                showToast(`Automation ${isActive ? 'activated' : 'deactivated'}`, 'success');
            } catch (e) {
                showToast('Error updating automation', 'error');
            }
        }

        async function deleteAutomation(id) {
            if (!confirm('Delete this automation?')) return;
            
            showLoading('Deleting...');
            try {
                await supabase.from('automations').delete().eq('id', id);
                await loadAutomations();
                await loadDashboardStats();
                hideLoading();
                showToast('Automation deleted', 'success');
            } catch (e) {
                hideLoading();
                showToast('Error deleting', 'error');
            }
        }

        async function createContact(e) {
            e.preventDefault();
            
            const username = document.getElementById('contactUsername').value.trim();
            const tagsStr = document.getElementById('contactTags').value;
            const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(t => t) : [];
            
            if (!username) {
                showToast('Username is required', 'error');
                return;
            }
            
            showLoading('Adding contact...');
            
            try {
                // Check limit
                const { count } = await supabase
                    .from('contacts')
                    .select('id', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id);
                
                if (planLimits.contacts !== -1 && count >= planLimits.contacts) {
                    hideLoading();
                    showToast('Contacts limit reached! Upgrade your plan.', 'warning');
                    return;
                }
                
                const { error } = await supabase.from('contacts').insert({
                    user_id: currentUser.id,
                    username,
                    tags: tags.length ? tags : null,
                    instagram_id: 'ig_' + Date.now()
                });
                
                if (error) throw error;
                
                document.getElementById('contactForm').reset();
                hideModal('contactModal');
                await loadContacts();
                await loadDashboardStats();
                hideLoading();
                showToast('Contact added!', 'success');
                
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function deleteContact(id) {
            if (!confirm('Delete this contact?')) return;
            
            showLoading('Deleting...');
            try {
                await supabase.from('contacts').delete().eq('id', id);
                await loadContacts();
                await loadDashboardStats();
                hideLoading();
                showToast('Contact deleted', 'success');
            } catch (e) {
                hideLoading();
                showToast('Error deleting', 'error');
            }
        }

        // ============================================
        // PAYMENT
        // ============================================
        async function upgradePlan(plan, amount) {
            const txnId = 'TXN' + Date.now();
            const upiUrl = `upi://pay?pa=${CONFIG.UPI_ID}&pn=InstaBot Pro&am=${amount}&tn=${plan} Plan&tr=${txnId}`;
            
            if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                window.location.href = upiUrl;
            } else {
                alert(`Pay via UPI:\n\nUPI ID: ${CONFIG.UPI_ID}\nAmount: â‚¹${amount}\nTransaction ID: ${txnId}`);
            }
            
            // Create pending subscription
            try {
                await supabase.from('subscriptions').insert({
                    user_id: currentUser.id,
                    plan_type: plan,
                    amount,
                    transaction_id: txnId,
                    payment_status: 'pending',
                    expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
                });
                
                await loadPaymentHistory();
                showToast('Payment initiated. Complete the payment.', 'info');
            } catch (e) {
                console.error('Subscription error:', e);
            }
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================
        function showLoading(text = 'Loading...') {
            const el = document.getElementById('loading');
            const textEl = document.getElementById('loadingText');
            if (el) el.classList.add('show');
            if (textEl) textEl.textContent = text;
        }

        function hideLoading() {
            const el = document.getElementById('loading');
            if (el) el.classList.remove('show');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMessage');
            const icon = document.getElementById('toastIcon');
            
            if (!toast) return console.log('Toast:', message);
            
            toast.className = 'toast show ' + type;
            if (msg) msg.textContent = message;
            if (icon) {
                const icons = { success: 'fa-check-circle', error: 'fa-times-circle', warning: 'fa-exclamation-circle', info: 'fa-info-circle' };
                icon.className = 'fas ' + (icons[type] || icons.info);
            }
            
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function showStatus(message, type = 'warning') {
            const banner = document.getElementById('statusBanner');
            const text = document.getElementById('statusText');
            if (banner) {
                banner.style.display = 'block';
                banner.className = 'status-banner' + (type === 'success' ? ' success' : type === 'info' ? ' info' : '');
            }
            if (text) text.textContent = message;
        }

        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('show');
        }

        function hideModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.remove('show');
        }

        function navigateTo(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            const section = document.getElementById(sectionId);
            const nav = document.querySelector(`[data-section="${sectionId}"]`);
            
            if (section) section.classList.add('active');
            if (nav) nav.classList.add('active');
            
            // Close mobile menu
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('mobileMenuIcon').className = 'fas fa-bars';
        }

        function showDashboard() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('mobileMenuBtn').style.display = 'flex';
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.name || 'User';
            document.getElementById('userEmail').textContent = currentUser.email || '';
            document.getElementById('userAvatar').textContent = (currentUser.name || 'U')[0].toUpperCase();
            
            // Avatar image
            if (currentUser.avatar_url) {
                document.getElementById('userAvatar').innerHTML = `<img src="${currentUser.avatar_url}" alt="">`;
            }
            
            // Plan badges
            const planType = currentUser.plan_type || 'free';
            const planLabel = planType.charAt(0).toUpperCase() + planType.slice(1);
            
            document.getElementById('planBadge').textContent = planLabel;
            document.getElementById('planBadge').className = 'badge badge-' + planType;
            document.getElementById('currentPlan').textContent = planLabel;
            document.getElementById('currentPlan').className = 'badge badge-' + planType;
            
            if (currentUser.plan_expiry) {
                document.getElementById('planExpiry').textContent = new Date(currentUser.plan_expiry).toLocaleDateString();
            }
            
            // Settings
            document.getElementById('settingsName').value = currentUser.name || '';
            document.getElementById('settingsEmail').value = currentUser.email || '';
        }

        function showLandingPage() {
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('mobileMenuBtn').style.display = 'none';
            document.getElementById('statusBanner').style.display = 'none';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
