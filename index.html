<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaBot Pro - Complete Instagram Automation Platform</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0084ff;
            --primary-dark: #0066cc;
            --secondary: #00d4aa;
            --success: #00c48c;
            --danger: #ff5757;
            --warning: #ffa800;
            --dark: #1a1d29;
            --darker: #12141d;
            --darkest: #0a0b10;
            --light: #ffffff;
            --gray: #8b92a7;
            --gray-light: #e8eaf0;
            --border: #2d3142;
            --glass: rgba(42, 46, 66, 0.6);
            --glass-border: rgba(255, 255, 255, 0.05);
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--darkest);
            color: var(--light);
            overflow-x: hidden;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.3;
            animation: float 25s infinite ease-in-out;
            z-index: 1;
            pointer-events: none;
        }

        .orb1 {
            width: 500px;
            height: 500px;
            background: var(--primary);
            top: -250px;
            left: -250px;
        }

        .orb2 {
            width: 600px;
            height: 600px;
            background: var(--secondary);
            bottom: -300px;
            right: -300px;
            animation-delay: -12s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(100px, -100px) scale(1.1); }
            66% { transform: translate(-100px, 100px) scale(0.9); }
        }

        .container {
            position: relative;
            z-index: 2;
            min-height: 100vh;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 28px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 132, 255, 0.15);
            border-color: rgba(0, 132, 255, 0.2);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0066cc);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 132, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 132, 255, 0.4);
        }

        .btn-secondary {
            background: var(--glass);
            color: var(--light);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--dark);
            border-color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #00a872);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 13px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .landing-page { display: block; }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 60px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 26px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero {
            text-align: center;
            padding: 120px 20px 80px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 64px;
            font-weight: 800;
            margin-bottom: 24px;
            line-height: 1.2;
        }

        .hero .highlight {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 22px;
            color: var(--gray);
            margin-bottom: 40px;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            padding: 80px 60px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .feature-card {
            text-align: left;
            padding: 40px 32px;
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 24px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .pricing {
            padding: 100px 60px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .pricing h2 {
            text-align: center;
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 60px;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .pricing-card {
            text-align: center;
            position: relative;
            padding: 40px 32px;
        }

        .pricing-card.popular {
            border: 2px solid var(--primary);
            transform: scale(1.05);
        }

        .pricing-card.popular::before {
            content: "MOST POPULAR";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 6px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .price {
            font-size: 56px;
            font-weight: 800;
            margin: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-list {
            list-style: none;
            margin: 30px 0;
            text-align: left;
        }

        .feature-list li {
            padding: 12px 0;
            color: var(--gray-light);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .feature-list i {
            color: var(--success);
        }

        .dashboard { display: none; min-height: 100vh; }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            padding: 24px 0;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid var(--border); margin-bottom: 24px; }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--dark);
            border-radius: 12px;
            margin-top: 16px;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid var(--primary);
        }

        .nav-section { padding: 0 16px; margin-bottom: 24px; }

        .nav-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--gray);
            text-transform: uppercase;
            padding: 0 12px 8px;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-light);
        }

        .nav-item:hover {
            background: var(--dark);
            color: var(--light);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light);
            font-weight: 600;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            padding: 40px;
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title { font-size: 32px; font-weight: 800; }

        .instagram-connect-card {
            background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045);
            border: none;
            text-align: center;
            padding: 48px;
            margin-bottom: 32px;
        }

        .instagram-connected {
            background: var(--dark);
            border: 1px solid var(--success);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .instagram-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--success);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 24px;
        }

        .stat-icon {
            font-size: 32px;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .stat-info h3 {
            font-size: 36px;
            font-weight: 800;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 14px;
        }

        .table-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table { width: 100%; border-collapse: collapse; }

        th, td {
            padding: 16px 24px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--dark);
            font-weight: 600;
            font-size: 13px;
            color: var(--gray);
            text-transform: uppercase;
        }

        tr:hover { background: var(--dark); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .close {
            font-size: 32px;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group { margin-bottom: 24px; }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--darker);
            color: var(--light);
            font-family: 'Inter', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-free { background: var(--border); color: var(--gray-light); }
        .badge-pro { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .badge-master { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
        .badge-active { background: var(--success); color: white; }
        .badge-inactive { background: var(--danger); color: white; }
        .badge-pending { background: var(--warning); color: white; }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 24px;
            border-radius: 12px;
            background: var(--dark);
            border: 1px solid var(--border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            gap: 14px;
            z-index: 3000;
            min-width: 300px;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 4000;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state i {
            font-size: 64px;
            color: var(--gray);
            opacity: 0.5;
            margin-bottom: 20px;
        }

        .section { display: none; }
        .section.active { display: block; }
        .hidden { display: none !important; }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .quick-action-card {
            background: var(--darker);
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .quick-action-card:hover {
            background: var(--dark);
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .quick-action-card i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 12px;
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 36px; }
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 20px; }
            .pricing-card.popular { transform: scale(1); }
        }

        .mobile-menu-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 8px 25px rgba(0, 132, 255, 0.4);
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message"></span>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <nav class="navbar">
            <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
            <button class="btn btn-primary" onclick="loginWithGoogle()">
                <i class="fab fa-google"></i> Start Free
            </button>
        </nav>

        <section class="hero">
            <h1>Automate Instagram DMs <br><span class="highlight">Like a Pro</span></h1>
            <p>Complete Instagram automation platform for businesses<br>Auto-reply, manage contacts, boost engagement</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i> Get Started Free
                </button>
            </div>
        </section>

        <section class="features">
            <div class="glass-card feature-card">
                <div class="feature-icon"><i class="fas fa-bolt"></i></div>
                <h3>Instant Auto-Reply</h3>
                <p>Respond to DMs automatically with smart triggers</p>
            </div>
            <div class="glass-card feature-card">
                <div class="feature-icon"><i class="fas fa-users"></i></div>
                <h3>Contact Manager</h3>
                <p>Organize contacts with tags and filters</p>
            </div>
            <div class="glass-card feature-card">
                <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Analytics</h3>
                <p>Track performance with real-time insights</p>
            </div>
        </section>

        <section class="pricing">
            <h2>Simple Pricing</h2>
            <div class="pricing-grid">
                <div class="glass-card pricing-card">
                    <h3>Free</h3>
                    <div class="price">₹0<span style="font-size: 18px;">/mo</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 1,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 3 Automations</li>
                    </ul>
                    <button class="btn btn-secondary" onclick="loginWithGoogle()">Start Free</button>
                </div>

                <div class="glass-card pricing-card popular">
                    <h3>Pro</h3>
                    <div class="price">₹199<span style="font-size: 18px;">/mo</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                        <li><i class="fas fa-check"></i> 25 Automations</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()">Start Pro</button>
                </div>

                <div class="glass-card pricing-card">
                    <h3>Master</h3>
                    <div class="price">₹499<span style="font-size: 18px;">/mo</span></div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Unlimited Everything</li>
                        <li><i class="fas fa-check"></i> API Access</li>
                    </ul>
                    <button class="btn btn-primary" onclick="loginWithGoogle()">Start Master</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><i class="fab fa-instagram"></i> InstaBot Pro</div>
                <div class="user-info">
                    <img src="" class="user-avatar" id="userAvatar">
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; font-size: 14px;" id="userName">Loading...</div>
                        <div style="font-size: 12px; color: var(--gray);" id="userPlanBadge">Free Plan</div>
                    </div>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">Main</div>
                <div class="nav-item active" onclick="showSection('dashboardSection')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" onclick="showSection('automationsSection')">
                    <i class="fas fa-robot"></i> Automations
                </div>
                <div class="nav-item" onclick="showSection('contactsSection')">
                    <i class="fas fa-users"></i> Contacts
                </div>
                <div class="nav-item" onclick="showSection('billingSection')">
                    <i class="fas fa-credit-card"></i> Billing
                </div>
                <div class="nav-item" onclick="showSection('settingsSection')">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-item hidden" id="adminNav" onclick="showSection('adminSection')">
                    <i class="fas fa-crown"></i> Admin
                </div>
                <div class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </div>
        </aside>

        <main class="main-content">
            <!-- Dashboard Section -->
            <div class="section active" id="dashboardSection">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                </div>

                <div id="instagramNotConnected" class="glass-card instagram-connect-card">
                    <h2><i class="fab fa-instagram"></i> Connect Instagram</h2>
                    <p>Connect your Instagram Business account</p>
                    <button class="btn btn-primary" onclick="connectInstagram()" style="background: white; color: #833ab4;">
                        <i class="fab fa-instagram"></i> Connect Account
                    </button>
                </div>

                <div id="instagramConnected" class="instagram-connected hidden">
                    <img src="" class="instagram-avatar" id="instaAvatar">
                    <div style="flex: 1;">
                        <h3>@<span id="instaUsername">username</span></h3>
                        <p style="color: var(--gray);"><i class="fas fa-check-circle" style="color: var(--success);"></i> Connected</p>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="disconnectInstagram()">
                        <i class="fas fa-unlink"></i> Disconnect
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="totalContacts">0</h3>
                            <p>Total Contacts</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-robot"></i></div>
                        <div class="stat-info">
                            <h3 id="totalAutomations">0</h3>
                            <p>Automations</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-paper-plane"></i></div>
                        <div class="stat-info">
                            <h3 id="messagesSent">0</h3>
                            <p>Messages Sent</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                        <div class="stat-info">
                            <h3 id="todayTriggers">0</h3>
                            <p>Today's Triggers</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="table-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="showModal('createAutomationModal')">
                            <i class="fas fa-plus-circle"></i>
                            <h4>New Automation</h4>
                        </div>
                        <div class="quick-action-card" onclick="showModal('addContactModal')">
                            <i class="fas fa-user-plus"></i>
                            <h4>Add Contact</h4>
                        </div>
                        <div class="quick-action-card" onclick="showSection('billingSection')">
                            <i class="fas fa-crown"></i>
                            <h4>Upgrade Plan</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Automations Section -->
            <div class="section" id="automationsSection">
                <div class="page-header">
                    <h1 class="page-title">Automations</h1>
                    <button class="btn btn-primary" onclick="showModal('createAutomationModal')">
                        <i class="fas fa-plus"></i> Create
                    </button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Trigger</th>
                                <th>Status</th>
                                <th>Stats</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="automationsTable">
                            <tr>
                                <td colspan="5">
                                    <div class="empty-state">
                                        <i class="fas fa-robot"></i>
                                        <h3>No automations yet</h3>
                                        <p>Create your first automation</p>
                                        <button class="btn btn-primary" onclick="showModal('createAutomationModal')">
                                            <i class="fas fa-plus"></i> Create
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contacts Section -->
            <div class="section" id="contactsSection">
                <div class="page-header">
                    <h1 class="page-title">Contacts</h1>
                    <button class="btn btn-primary" onclick="showModal('addContactModal')">
                        <i class="fas fa-user-plus"></i> Add
                    </button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Contact</th>
                                <th>Tags</th>
                                <th>Last Message</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTable">
                            <tr>
                                <td colspan="4">
                                    <div class="empty-state">
                                        <i class="fas fa-users"></i>
                                        <h3>No contacts yet</h3>
                                        <p>Add your first contact</p>
                                        <button class="btn btn-primary" onclick="showModal('addContactModal')">
                                            <i class="fas fa-user-plus"></i> Add
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Billing Section -->
            <div class="section" id="billingSection">
                <div class="page-header">
                    <h1 class="page-title">Billing</h1>
                </div>

                <div class="glass-card" style="margin-bottom: 32px;">
                    <h2>Current Plan: <span id="currentPlan" class="badge badge-free">Free</span></h2>
                    <p style="color: var(--gray); margin-top: 8px;">Expiry: <span id="planExpiry">-</span></p>
                </div>

                <div class="pricing-grid" style="margin-bottom: 40px;">
                    <div class="glass-card pricing-card">
                        <h3>Pro</h3>
                        <div class="price">₹199<span style="font-size: 18px;">/mo</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> 10,000 Contacts</li>
                            <li><i class="fas fa-check"></i> 25 Automations</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('pro', 199)">Upgrade</button>
                    </div>

                    <div class="glass-card pricing-card">
                        <h3>Master</h3>
                        <div class="price">₹499<span style="font-size: 18px;">/mo</span></div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Unlimited</li>
                            <li><i class="fas fa-check"></i> API Access</li>
                        </ul>
                        <button class="btn btn-primary" onclick="upgradePlan('master', 499)">Upgrade</button>
                    </div>
                </div>

                <div class="glass-card">
                    <h3 style="margin-bottom: 20px;">Payment History</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Plan</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistory">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 40px;">No payments</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settingsSection">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                </div>

                <div class="glass-card">
                    <h2 style="margin-bottom: 24px;">Profile</h2>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" class="form-control" id="settingsName" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="settingsEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label>Instagram Status</label>
                        <p id="instaStatus" style="color: var(--gray);">Not connected</p>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div class="section" id="adminSection">
                <div class="page-header">
                    <h1 class="page-title">Admin Panel</h1>
                </div>

                <div class="stats-grid" style="margin-bottom: 32px;">
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="adminTotalUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <h3 id="adminRevenue">₹0</h3>
                            <p>Revenue</p>
                        </div>
                    </div>
                    <div class="glass-card stat-card">
                        <div class="stat-icon"><i class="fas fa-crown"></i></div>
                        <div class="stat-info">
                            <h3 id="adminProUsers">0</h3>
                            <p>Paid Users</p>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="margin-bottom: 24px;">
                    <h3>Manage Plans</h3>
                    <button class="btn btn-primary" style="margin-top: 16px;" onclick="showModal('editPlanModal')">
                        <i class="fas fa-edit"></i> Edit Plans
                    </button>
                </div>

                <div class="glass-card">
                    <h3 style="margin-bottom: 20px;">All Users</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Plan</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminUsersTable">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 40px;">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="createAutomationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Automation</h2>
                <span class="close" onclick="hideModal('createAutomationModal')">&times;</span>
            </div>
            <form onsubmit="createAutomation(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" class="form-control" id="automationName" required>
                </div>
                <div class="form-group">
                    <label>Trigger Type</label>
                    <select class="form-control" id="triggerType" required>
                        <option value="keyword_dm">Keyword in DM</option>
                        <option value="keyword_comment">Keyword in Comment</option>
                        <option value="story_mention">Story Mention</option>
                        <option value="first_message">First Message</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Keywords (comma separated)</label>
                    <input type="text" class="form-control" id="triggerKeywords" required>
                </div>
                <div class="form-group">
                    <label>Response Message</label>
                    <textarea class="form-control" id="responseMessage" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create</button>
            </form>
        </div>
    </div>

    <div class="modal" id="addContactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Contact</h2>
                <span class="close" onclick="hideModal('addContactModal')">&times;</span>
            </div>
            <form onsubmit="addContact(event)">
                <div class="form-group">
                    <label>Instagram Username</label>
                    <input type="text" class="form-control" id="contactUsername" required>
                </div>
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" class="form-control" id="contactTags">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Add</button>
            </form>
        </div>
    </div>

    <div class="modal" id="editPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Plans</h2>
                <span class="close" onclick="hideModal('editPlanModal')">&times;</span>
            </div>
            <form onsubmit="updatePlans(event)">
                <h3>Free Plan</h3>
                <div class="form-group">
                    <label>Contacts Limit</label>
                    <input type="number" class="form-control" id="freeLimitContacts" value="1000">
                </div>
                <div class="form-group">
                    <label>Automations Limit</label>
                    <input type="number" class="form-control" id="freeLimitAuto" value="3">
                </div>
                <h3 style="margin-top: 24px;">Pro Plan</h3>
                <div class="form-group">
                    <label>Price (₹)</label>
                    <input type="number" class="form-control" id="proPrice" value="199">
                </div>
                <div class="form-group">
                    <label>Contacts Limit</label>
                    <input type="number" class="form-control" id="proLimitContacts" value="10000">
                </div>
                <div class="form-group">
                    <label>Automations Limit</label>
                    <input type="number" class="form-control" id="proLimitAuto" value="25">
                </div>
                <h3 style="margin-top: 24px;">Master Plan</h3>
                <div class="form-group">
                    <label>Price (₹)</label>
                    <input type="number" class="form-control" id="masterPrice" value="499">
                </div>
                <div class="form-group">
                    <label>Contacts (-1 = unlimited)</label>
                    <input type="number" class="form-control" id="masterLimitContacts" value="-1">
                </div>
                <div class="form-group">
                    <label>Automations (-1 = unlimited)</label>
                    <input type="number" class="form-control" id="masterLimitAuto" value="-1">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Update</button>
            </form>
        </div>
    </div>

    <div class="modal" id="changeUserPlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Change Plan</h2>
                <span class="close" onclick="hideModal('changeUserPlanModal')">&times;</span>
            </div>
            <form onsubmit="changeUserPlan(event)">
                <input type="hidden" id="changeUserId">
                <div class="form-group">
                    <label>User: <strong id="changeUserName"></strong></label>
                </div>
                <div class="form-group">
                    <label>New Plan</label>
                    <select class="form-control" id="newPlanType" required>
                        <option value="free">Free</option>
                        <option value="pro">Pro</option>
                        <option value="master">Master</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Change</button>
            </form>
        </div>
    </div>

    <button class="mobile-menu-btn" onclick="document.getElementById('sidebar').classList.toggle('open')">
        <i class="fas fa-bars"></i>
    </button>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://uvnksakgjupnivmfkjcv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2bmtzYWtnanVwbml2bWZramN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzM5NzYsImV4cCI6MjA4MTQ0OTk3Nn0.gM5hYGxnUI-n_zM-iut8Dml1T5593YhH5A9HNo8hovA';
        const UPI_ID = 'your-upi@ybl';
        const META_APP_ID = 'YOUR_META_APP_ID';
        const REDIRECT_URI = window.location.origin;
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentUser = null;
        let userPlanLimits = { contacts: 1000, automations: 3 };

        // Particles
        particlesJS('particles-js', {
            particles: {
                number: { value: 60 },
                color: { value: '#0084ff' },
                opacity: { value: 0.3 },
                size: { value: 3 },
                line_linked: { enable: true, distance: 150, color: '#0084ff', opacity: 0.2 },
                move: { enable: true, speed: 1.5 }
            }
        });

        // Auth
        async function loginWithGoogle() {
            try {
                showLoading();
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: { redirectTo: REDIRECT_URI }
                });
                if (error) throw error;
            } catch (error) {
                hideLoading();
                showToast('Login failed: ' + error.message, 'error');
            }
        }

        async function logout() {
            try {
                showLoading();
                await supabase.auth.signOut();
                currentUser = null;
                document.getElementById('landingPage').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                hideLoading();
                showToast('Logged out', 'success');
            } catch (error) {
                hideLoading();
                showToast('Logout failed', 'error');
            }
        }

        // Instagram
        function connectInstagram() {
            if (META_APP_ID === 'YOUR_META_APP_ID') {
                showToast('Configure META_APP_ID first', 'warning');
                console.log('Setup: https://developers.facebook.com/apps/');
                return;
            }
            const scope = 'instagram_basic,instagram_manage_messages,pages_manage_metadata';
            const authUrl = `https://www.facebook.com/v18.0/dialog/oauth?client_id=${META_APP_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${scope}&response_type=code`;
            window.open(authUrl, 'Instagram', 'width=600,height=700');
        }

        async function disconnectInstagram() {
            if (!confirm('Disconnect Instagram?')) return;
            try {
                showLoading();
                await supabase.from('users').update({
                    instagram_connected: false,
                    instagram_token: null,
                    instagram_username: null
                }).eq('id', currentUser.id);
                currentUser.instagram_connected = false;
                document.getElementById('instagramNotConnected').classList.remove('hidden');
                document.getElementById('instagramConnected').classList.add('hidden');
                hideLoading();
                showToast('Disconnected', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error', 'error');
            }
        }

        // Auth State
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                await handleUserLogin(session.user);
            } else {
                document.getElementById('landingPage').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        async function handleUserLogin(user) {
            try {
                showLoading();
                const { data: existingUser, error: fetchError } = await supabase
                    .from('users').select('*').eq('id', user.id).single();

                if (fetchError && fetchError.code !== 'PGRST116') throw fetchError;

                if (!existingUser) {
                    await supabase.from('users').insert({
                        id: user.id,
                        email: user.email,
                        name: user.user_metadata.full_name || user.email.split('@')[0],
                        avatar_url: user.user_metadata.avatar_url,
                        google_id: user.user_metadata.sub,
                        plan_type: 'free',
                        plan_expiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        created_at: new Date().toISOString()
                    });

                    const { data: newUser } = await supabase.from('users').select('*').eq('id', user.id).single();
                    currentUser = newUser;
                } else {
                    currentUser = existingUser;
                }

                await loadPlanLimits();
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';

                if (currentUser.is_admin) {
                    document.getElementById('adminNav').classList.remove('hidden');
                }

                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userPlanBadge').textContent = currentUser.plan_type.toUpperCase();
                document.getElementById('userAvatar').src = currentUser.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}`;

                await loadDashboard();
                hideLoading();
                showToast('Welcome ' + currentUser.name, 'success');
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function loadPlanLimits() {
            try {
                const { data } = await supabase.from('plans').select('*').eq('name', currentUser.plan_type).single();
                if (data) {
                    userPlanLimits = {
                        contacts: data.contacts_limit,
                        automations: data.automations_limit
                    };
                }
            } catch (error) {
                console.error('Plan limits error:', error);
            }
        }

        async function loadDashboard() {
            try {
                const { data: contacts, count: contactsCount } = await supabase
                    .from('contacts').select('*', { count: 'exact' }).eq('user_id', currentUser.id);

                const { data: automations, count: automationsCount } = await supabase
                    .from('automations').select('*', { count: 'exact' }).eq('user_id', currentUser.id);

                let totalTriggered = 0;
                if (automations) {
                    automations.forEach(a => {
                        if (a.stats?.triggered) totalTriggered += a.stats.triggered;
                    });
                }

                document.getElementById('totalContacts').textContent = contactsCount || 0;
                document.getElementById('totalAutomations').textContent = automationsCount || 0;
                document.getElementById('messagesSent').textContent = totalTriggered;
                document.getElementById('todayTriggers').textContent = Math.floor(totalTriggered * 0.15);

                if (currentUser.instagram_connected) {
                    document.getElementById('instagramNotConnected').classList.add('hidden');
                    document.getElementById('instagramConnected').classList.remove('hidden');
                    document.getElementById('instaUsername').textContent = currentUser.instagram_username;
                    document.getElementById('instaAvatar').src = `https://ui-avatars.com/api/?name=${currentUser.instagram_username}&background=833ab4&color=fff`;
                } else {
                    document.getElementById('instagramNotConnected').classList.remove('hidden');
                    document.getElementById('instagramConnected').classList.add('hidden');
                }

                document.getElementById('settingsName').value = currentUser.name;
                document.getElementById('settingsEmail').value = currentUser.email;
                document.getElementById('instaStatus').textContent = currentUser.instagram_connected ? 
                    '✓ Connected as @' + currentUser.instagram_username : 'Not connected';

                const planBadge = document.getElementById('currentPlan');
                planBadge.textContent = currentUser.plan_type.toUpperCase();
                planBadge.className = 'badge badge-' + currentUser.plan_type;
                
                if (currentUser.plan_expiry) {
                    document.getElementById('planExpiry').textContent = new Date(currentUser.plan_expiry).toLocaleDateString('en-IN');
                }

                await loadPaymentHistory();
                await loadAutomations();
                await loadContacts();

                if (currentUser.is_admin) await loadAdminData();
            } catch (error) {
                console.error('Dashboard error:', error);
            }
        }

        async function loadAutomations() {
            try {
                const { data } = await supabase.from('automations').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
                const tbody = document.getElementById('automationsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="4"><div class="empty-state"><i class="fas fa-users"></i><h3>No contacts</h3><button class="btn btn-primary" onclick="showModal('addContactModal')">Add</button></div></td></tr>`;
                    return;
                }

                tbody.innerHTML = data.map(c => `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <img src="${c.profile_pic}" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary);">
                                <strong>@${c.username}</strong>
                            </div>
                        </td>
                        <td>${c.tags ? c.tags.map(t => `<span class="badge badge-pro">${t}</span>`).join(' ') : '<span style="color: var(--gray);">-</span>'}</td>
                        <td>${c.last_message_at ? new Date(c.last_message_at).toLocaleDateString('en-IN') : 'Never'}</td>
                        <td>
                            <button class="btn btn-icon btn-danger" onclick="deleteContact('${c.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Contacts error:', error);
            }
        }

        async function addContact(e) {
            e.preventDefault();
            try {
                showLoading();
                const { count } = await supabase.from('contacts').select('id', { count: 'exact', head: true }).eq('user_id', currentUser.id);

                if (userPlanLimits.contacts !== -1 && count >= userPlanLimits.contacts) {
                    hideLoading();
                    showToast('Limit reached! Upgrade plan', 'warning');
                    return;
                }

                const username = document.getElementById('contactUsername').value;
                const tags = document.getElementById('contactTags').value.split(',').map(t => t.trim()).filter(t => t);

                await supabase.from('contacts').insert({
                    user_id: currentUser.id,
                    username: username,
                    instagram_id: 'ig_' + Math.random().toString(36).substr(2, 9),
                    profile_pic: `https://ui-avatars.com/api/?name=${username}&background=random`,
                    tags: tags.length > 0 ? tags : null,
                    created_at: new Date().toISOString()
                });

                hideModal('addContactModal');
                e.target.reset();
                await loadContacts();
                await loadDashboard();
                hideLoading();
                showToast('Contact added', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function deleteContact(id) {
            if (!confirm('Delete contact?')) return;
            try {
                showLoading();
                await supabase.from('contacts').delete().eq('id', id);
                await loadContacts();
                await loadDashboard();
                hideLoading();
                showToast('Deleted', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error', 'error');
            }
        }

        async function loadPaymentHistory() {
            try {
                const { data } = await supabase.from('subscriptions').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false }).limit(10);
                const tbody = document.getElementById('paymentHistory');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px;">No payments</td></tr>';
                    return;
                }

                tbody.innerHTML = data.map(p => `
                    <tr>
                        <td>${new Date(p.created_at).toLocaleDateString('en-IN')}</td>
                        <td><span class="badge badge-${p.plan_type}">${p.plan_type.toUpperCase()}</span></td>
                        <td><strong>₹${p.amount}</strong></td>
                        <td><span class="badge badge-${p.payment_status === 'success' ? 'active' : p.payment_status === 'pending' ? 'pending' : 'inactive'}">${p.payment_status.toUpperCase()}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Payment history error:', error);
            }
        }

        function upgradePlan(planType, amount) {
            const transactionId = 'TXN' + Date.now() + Math.random().toString(36).substr(2, 9);
            const upiUrl = `upi://pay?pa=${UPI_ID}&pn=InstaBot Pro&am=${amount}&tn=Subscription ${planType}&tr=${transactionId}`;
            
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = upiUrl;
            } else {
                alert(`Payment Details:\n\nUPI ID: ${UPI_ID}\nAmount: ₹${amount}\nPlan: ${planType.toUpperCase()}\nTransaction ID: ${transactionId}\n\nAfter payment, contact support.`);
            }
            
            createPendingSubscription(planType, amount, transactionId);
        }

        async function createPendingSubscription(planType, amount, transactionId) {
            try {
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + 1);
                
                await supabase.from('subscriptions').insert({
                    user_id: currentUser.id,
                    plan_type: planType,
                    amount: amount,
                    transaction_id: transactionId,
                    payment_status: 'pending',
                    payment_method: 'phonepe',
                    created_at: new Date().toISOString(),
                    expires_at: expiryDate.toISOString()
                });

                showToast('Payment initiated', 'warning');
                await loadPaymentHistory();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function loadAdminData() {
            try {
                const { data: users } = await supabase.from('users').select('*');
                document.getElementById('adminTotalUsers').textContent = users.length;

                const { data: subscriptions } = await supabase.from('subscriptions').select('amount').eq('payment_status', 'success');
                const totalRevenue = subscriptions?.reduce((sum, sub) => sum + sub.amount, 0) || 0;
                document.getElementById('adminRevenue').textContent = '₹' + totalRevenue.toLocaleString('en-IN');

                const paidUsers = users.filter(u => u.plan_type !== 'free').length;
                document.getElementById('adminProUsers').textContent = paidUsers;

                const tbody = document.getElementById('adminUsersTable');
                tbody.innerHTML = users.map(u => `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <img src="${u.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(u.name)}`}" style="width: 36px; height: 36px; border-radius: 50%;">
                                <strong>${u.name}</strong>
                            </div>
                        </td>
                        <td>${u.email}</td>
                        <td><span class="badge badge-${u.plan_type}">${u.plan_type.toUpperCase()}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="openChangePlanModal('${u.id}', '${u.name}')">
                                <i class="fas fa-edit"></i> Change
                            </button>
                        </td>
                    </tr>
                `).join('');

                const { data: plans } = await supabase.from('plans').select('*');
                if (plans) {
                    plans.forEach(plan => {
                        if (plan.name === 'free') {
                            document.getElementById('freeLimitContacts').value = plan.contacts_limit;
                            document.getElementById('freeLimitAuto').value = plan.automations_limit;
                        } else if (plan.name === 'pro') {
                            document.getElementById('proPrice').value = plan.price;
                            document.getElementById('proLimitContacts').value = plan.contacts_limit;
                            document.getElementById('proLimitAuto').value = plan.automations_limit;
                        } else if (plan.name === 'master') {
                            document.getElementById('masterPrice').value = plan.price;
                            document.getElementById('masterLimitContacts').value = plan.contacts_limit;
                            document.getElementById('masterLimitAuto').value = plan.automations_limit;
                        }
                    });
                }
            } catch (error) {
                console.error('Admin error:', error);
            }
        }

        async function updatePlans(e) {
            e.preventDefault();
            try {
                showLoading();
                await supabase.from('plans').update({
                    contacts_limit: parseInt(document.getElementById('freeLimitContacts').value),
                    automations_limit: parseInt(document.getElementById('freeLimitAuto').value)
                }).eq('name', 'free');

                await supabase.from('plans').update({
                    price: parseInt(document.getElementById('proPrice').value),
                    contacts_limit: parseInt(document.getElementById('proLimitContacts').value),
                    automations_limit: parseInt(document.getElementById('proLimitAuto').value)
                }).eq('name', 'pro');

                await supabase.from('plans').update({
                    price: parseInt(document.getElementById('masterPrice').value),
                    contacts_limit: parseInt(document.getElementById('masterLimitContacts').value),
                    automations_limit: parseInt(document.getElementById('masterLimitAuto').value)
                }).eq('name', 'master');

                hideModal('editPlanModal');
                hideLoading();
                showToast('Plans updated', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        function openChangePlanModal(userId, userName) {
            document.getElementById('changeUserId').value = userId;
            document.getElementById('changeUserName').textContent = userName;
            showModal('changeUserPlanModal');
        }

        async function changeUserPlan(e) {
            e.preventDefault();
            try {
                showLoading();
                const userId = document.getElementById('changeUserId').value;
                const newPlan = document.getElementById('newPlanType').value;
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + 1);

                await supabase.from('users').update({
                    plan_type: newPlan,
                    plan_expiry: expiryDate.toISOString()
                }).eq('id', userId);

                hideModal('changeUserPlanModal');
                await loadAdminData();
                hideLoading();
                showToast('Plan changed', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            document.getElementById('sidebar').classList.remove('open');
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', warning: 'fa-exclamation-triangle' };
            
            toast.className = 'toast ' + type;
            toast.querySelector('i').className = 'fas ' + icons[type];
            toastMessage.textContent = message;
            toast.style.display = 'flex';

            setTimeout(() => { toast.style.display = 'none'; }, 4000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        window.addEventListener('load', async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                await handleUserLogin(session.user);
            }
        });

        /*
        DATABASE SETUP SQL:
        
        -- Users table
        CREATE TABLE users (
            id UUID PRIMARY KEY REFERENCES auth.users(id),
            email TEXT UNIQUE NOT NULL,
            name TEXT,
            avatar_url TEXT,
            google_id TEXT,
            instagram_connected BOOLEAN DEFAULT false,
            instagram_token TEXT,
            instagram_username TEXT,
            instagram_id TEXT,
            plan_type TEXT DEFAULT 'free',
            plan_expiry TIMESTAMP,
            contacts_count INTEGER DEFAULT 0,
            automations_count INTEGER DEFAULT 0,
            is_admin BOOLEAN DEFAULT false,
            created_at TIMESTAMP DEFAULT NOW(),
            updated_at TIMESTAMP DEFAULT NOW()
        );

        -- Contacts table
        CREATE TABLE contacts (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            instagram_id TEXT,
            username TEXT NOT NULL,
            profile_pic TEXT,
            tags TEXT[],
            last_message_at TIMESTAMP,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Automations table
        CREATE TABLE automations (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            name TEXT NOT NULL,
            trigger_type TEXT NOT NULL,
            trigger_keywords TEXT[],
            response_message TEXT NOT NULL,
            is_active BOOLEAN DEFAULT true,
            stats JSONB DEFAULT '{"triggered": 0, "replied": 0}'::jsonb,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Messages table
        CREATE TABLE messages (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            contact_id UUID REFERENCES contacts(id) ON DELETE CASCADE,
            content TEXT NOT NULL,
            sender_type TEXT NOT NULL,
            is_automated BOOLEAN DEFAULT false,
            created_at TIMESTAMP DEFAULT NOW()
        );

        -- Subscriptions table
        CREATE TABLE subscriptions (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            user_id UUID REFERENCES users(id) ON DELETE CASCADE,
            plan_type TEXT NOT NULL,
            amount INTEGER NOT NULL,
            transaction_id TEXT,
            payment_status TEXT DEFAULT 'pending',
            payment_method TEXT DEFAULT 'phonepe',
            created_at TIMESTAMP DEFAULT NOW(),
            expires_at TIMESTAMP
        );

        -- Plans table
        CREATE TABLE plans (
            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
            name TEXT UNIQUE NOT NULL,
            price INTEGER NOT NULL,
            contacts_limit INTEGER NOT NULL,
            automations_limit INTEGER NOT NULL,
            team_members_limit INTEGER NOT NULL,
            features JSONB,
            is_active BOOLEAN DEFAULT true
        );

        -- Insert default plans
        INSERT INTO plans (name, price, contacts_limit, automations_limit, team_members_limit, is_active) VALUES
        ('free', 0, 1000, 3, 1, true),
        ('pro', 199, 10000, 25, 5, true),
        ('master', 499, -1, -1, -1, true);

        -- Enable RLS
        ALTER TABLE users ENABLE ROW LEVEL SECURITY;
        ALTER TABLE contacts ENABLE ROW LEVEL SECURITY;
        ALTER TABLE automations ENABLE ROW LEVEL SECURITY;
        ALTER TABLE messages ENABLE ROW LEVEL SECURITY;
        ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
        ALTER TABLE plans ENABLE ROW LEVEL SECURITY;

        -- Policies
        CREATE POLICY "Users view own" ON users FOR SELECT USING (auth.uid() = id);
        CREATE POLICY "Users update own" ON users FOR UPDATE USING (auth.uid() = id);
        CREATE POLICY "Users insert own" ON users FOR INSERT WITH CHECK (auth.uid() = id);
        CREATE POLICY "Admins view all" ON users FOR SELECT USING (EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true));
        CREATE POLICY "Admins update all" ON users FOR UPDATE USING (EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true));
        CREATE POLICY "Users manage own contacts" ON contacts FOR ALL USING (auth.uid() = user_id);
        CREATE POLICY "Users manage own automations" ON automations FOR ALL USING (auth.uid() = user_id);
        CREATE POLICY "Users manage own messages" ON messages FOR ALL USING (auth.uid() = user_id);
        CREATE POLICY "Users view own subs" ON subscriptions FOR SELECT USING (auth.uid() = user_id);
        CREATE POLICY "Users insert own subs" ON subscriptions FOR INSERT WITH CHECK (auth.uid() = user_id);
        CREATE POLICY "Admins view all subs" ON subscriptions FOR SELECT USING (EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true));
        CREATE POLICY "Anyone view plans" ON plans FOR SELECT USING (true);
        CREATE POLICY "Admins update plans" ON plans FOR UPDATE USING (EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_admin = true));

        -- Make yourself admin
        UPDATE users SET is_admin = true WHERE email = 'your-email@gmail.com';
        */

        console.log('%c🎉 InstaBot Pro Ready!', 'color: #0084ff; font-size: 24px; font-weight: bold;');
        console.log('%c✅ Setup: Configure SUPABASE_URL, SUPABASE_ANON_KEY, UPI_ID, META_APP_ID', 'color: #00d4aa; font-size: 14px;');
    </script>
</body>
</html> = `<tr><td colspan="5"><div class="empty-state"><i class="fas fa-robot"></i><h3>No automations</h3><button class="btn btn-primary" onclick="showModal('createAutomationModal')">Create</button></div></td></tr>`;
                    return;
                }

                tbody.innerHTML = data.map(a => `
                    <tr>
                        <td><strong>${a.name}</strong></td>
                        <td><span class="badge badge-pro">${a.trigger_type.replace(/_/g, ' ').toUpperCase()}</span></td>
                        <td>
                            <label class="toggle">
                                <input type="checkbox" ${a.is_active ? 'checked' : ''} onchange="toggleAutomation('${a.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </td>
                        <td>Triggered: ${a.stats?.triggered || 0} | Replied: ${a.stats?.replied || 0}</td>
                        <td>
                            <button class="btn btn-icon btn-danger" onclick="deleteAutomation('${a.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Automations error:', error);
            }
        }

        async function createAutomation(e) {
            e.preventDefault();
            try {
                showLoading();
                const { count } = await supabase.from('automations').select('id', { count: 'exact', head: true }).eq('user_id', currentUser.id);

                if (userPlanLimits.automations !== -1 && count >= userPlanLimits.automations) {
                    hideLoading();
                    showToast('Limit reached! Upgrade plan', 'warning');
                    return;
                }

                await supabase.from('automations').insert({
                    user_id: currentUser.id,
                    name: document.getElementById('automationName').value,
                    trigger_type: document.getElementById('triggerType').value,
                    trigger_keywords: document.getElementById('triggerKeywords').value.split(',').map(k => k.trim()),
                    response_message: document.getElementById('responseMessage').value,
                    is_active: true,
                    stats: { triggered: 0, replied: 0 },
                    created_at: new Date().toISOString()
                });

                hideModal('createAutomationModal');
                e.target.reset();
                await loadAutomations();
                await loadDashboard();
                hideLoading();
                showToast('Automation created', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function toggleAutomation(id, isActive) {
            try {
                await supabase.from('automations').update({ is_active: isActive }).eq('id', id);
                showToast(isActive ? 'Activated' : 'Deactivated', 'success');
            } catch (error) {
                showToast('Error', 'error');
            }
        }

        async function deleteAutomation(id) {
            if (!confirm('Delete automation?')) return;
            try {
                showLoading();
                await supabase.from('automations').delete().eq('id', id);
                await loadAutomations();
                await loadDashboard();
                hideLoading();
                showToast('Deleted', 'success');
            } catch (error) {
                hideLoading();
                showToast('Error', 'error');
            }
        }

        async function loadContacts() {
            try {
                const { data } = await supabase.from('contacts').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
                const tbody = document.getElementById('contactsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTMLasync function loadContacts() {
    try {
        const { data } = await supabase.from('contacts').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
        const tbody = document.getElementById('contactsTable');
        
        if (!data || data.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="4">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No contacts yet</h3>
                            <p>Add your first contact to start managing your Instagram audience</p>
                            <button class="btn btn-primary" onclick="showModal('addContactModal')">
                                <i class="fas fa-user-plus"></i> Add Contact
                            </button>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        tbody.innerHTML = data.map(contact => `
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <img src="${contact.profile_pic}" 
                             alt="${contact.username}" 
                             style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary);">
                        <strong>@${contact.username}</strong>
                    </div>
                </td>
                <td>
                    ${contact.tags && contact.tags.length > 0 
                        ? contact.tags.map(tag => `<span class="badge badge-pro">${tag}</span>`).join(' ') 
                        : '<span style="color: var(--gray);">No tags</span>'}
                </td>
                <td>
                    <span style="color: var(--gray); font-size: 13px;">
                        ${contact.last_message_at 
                            ? new Date(contact.last_message_at).toLocaleDateString('en-IN', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            })
                            : 'Never'}
                    </span>
                </td>
                <td>
                    <div class="action-btns">
                        <button class="btn btn-icon btn-danger" 
                                onclick="deleteContact('${contact.id}')" 
                                title="Delete contact">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
        
    } catch (error) {
        console.error('Error loading contacts:', error);
        showToast('Error loading contacts: ' + error.message, 'error');
        
        // Show error state in table
        const tbody = document.getElementById('contactsTable');
        tbody.innerHTML = `
            <tr>
                <td colspan="4">
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>
                        <h3>Error loading contacts</h3>
                        <p>Please try again</p>
                        <button class="btn btn-primary" onclick="loadContacts()">
                            <i class="fas fa-sync"></i> Retry
                        </button>
                    </div>
                </td>
            </tr>
        `;
    }
}
